# åˆ©æ¶¦ã€ä¿æœ¬ROIã€ä¿æœ¬å¹¿å‘Šå æ¯”è®¡ç®—å‡½æ•°æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†ä¸‰ä¸ªæ ¸å¿ƒè®¡ç®—å‡½æ•°çš„JavaScriptä¼ªä»£ç å®ç°ï¼Œç”¨äºè®¡ç®—ç”µå•†ä¸šåŠ¡çš„åˆ©æ¶¦ã€ä¿æœ¬ROIå’Œä¿æœ¬å¹¿å‘Šå æ¯”ã€‚æ‰€æœ‰å‡½æ•°éƒ½ä¸¥æ ¼ä½¿ç”¨ç³»ç»Ÿå†…å®šä¹‰çš„å­—æ®µåç§°ï¼Œç¡®ä¿ä¸ç°æœ‰ä»£ç çš„ä¸€è‡´æ€§ã€‚

## ğŸ”§ å¸¸é‡å®šä¹‰

```javascript
// æœåŠ¡ä¸šï¼ˆå¹¿å‘Š/å¹³å°ï¼‰å¢å€¼ç¨ç¨ç‡ 6%ï¼ˆå¯æŠµæ‰£ï¼‰
const SERVICE_VAT = 0.06;
```

## ğŸ’° åˆ©æ¶¦è®¡ç®—å‡½æ•°

### å‡½æ•°åï¼š`calculateProfit` **å‡è®¾åå­—**

**åŠŸèƒ½**ï¼šè®¡ç®—æ¯ä¸ªæœ‰æ•ˆæˆäº¤çš„åˆ©æ¶¦

**å‚æ•°è¯´æ˜**ï¼š
- `costPrice`ï¼šè¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰
- `inputTaxRate`ï¼šå¼€ç¥¨æˆæœ¬æ¯”ä¾‹
- `outputTaxRate`ï¼šå•†å“è¿›é¡¹ç¨ç‡ï¼ˆå¯æŠµæ‰£ï¼‰
- `sellingPrice`ï¼šå”®ä»·ï¼ˆå«ç¨ï¼‰
- `salesTaxRate`ï¼šé”€é¡¹ç¨ç‡
- `platformRate`ï¼šå¹³å°ä½£é‡‘ç‡
- `adRate`ï¼šå¹¿å‘Šè´¹å æ¯”ï¼ˆå«ç¨/æŒ‰å”®ä»·ï¼‰
- `shippingCost`ï¼šç‰©æµè´¹
- `shippingInsurance`ï¼šè¿è´¹é™©
- `otherCost`ï¼šå…¶ä»–æˆæœ¬
- `returnRate`ï¼šé€€è´§ç‡

**è®¡ç®—é€»è¾‘**ï¼š

```javascript
/**
 * åˆ©æ¶¦ï¼ˆæ¯ä¸ªæœ‰æ•ˆæˆäº¤ï¼‰
 */
function calculateProfit(params) {
  const {
    costPrice,          // è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰
    inputTaxRate,       // å¼€ç¥¨æˆæœ¬æ¯”ä¾‹
    outputTaxRate,      // å•†å“è¿›é¡¹ç¨ç‡ï¼ˆå¯æŠµæ‰£ï¼‰
    sellingPrice,       // å”®ä»·ï¼ˆå«ç¨ï¼‰
    salesTaxRate,       // é”€é¡¹ç¨ç‡
    platformRate,       // å¹³å°ä½£é‡‘ç‡
    adRate,             // å¹¿å‘Šè´¹å æ¯”ï¼ˆå«ç¨/æŒ‰å”®ä»·ï¼‰
    shippingCost,       // ç‰©æµè´¹
    shippingInsurance,  // è¿è´¹é™©
    otherCost,          // å…¶ä»–æˆæœ¬
    returnRate          // é€€è´§ç‡
  } = params;

  // 1) æœ‰æ•ˆç‡
  const E = 1 - returnRate;

  // 2) æˆæœ¬å£å¾„ï¼ˆå…¨éƒ¨å‡€é¢ï¼Œä¸å«ç¨ï¼‰
  const goodsCost = costPrice * (1 + inputTaxRate);                        // è¿›è´§å‡€æˆæœ¬
  const fixCost   = (shippingCost + shippingInsurance + otherCost) / E;    // å›ºå®šæˆæœ¬éšå‘è´§æ‘Šåˆ°æœ‰æ•ˆå•
  const adCost    = (sellingPrice * adRate) / E;                            // å¹¿å‘Šè´¹ä¹Ÿéœ€éšå‘è´§æ‘Šåˆ°æœ‰æ•ˆå•ï¼ˆå«ç¨é‡‘é¢ï¼Œè§ç¨å¤„ç†ï¼‰
  const platformCost = sellingPrice * platformRate;                         // å¹³å°ä½£é‡‘æŒ‰æˆäº¤è®¡ï¼ˆå«ç¨é‡‘é¢ï¼Œè§ç¨å¤„ç†ï¼‰

  // 3) ç¨é‡‘ï¼ˆä»·å†…å£å¾„ï¼‰
  const outputVAT = sellingPrice * (salesTaxRate / (1 + salesTaxRate));     // é”€é¡¹ç¨é¢ï¼ˆå«ç¨ä»·æ‹†å‡ºçš„ç¨é¢ï¼‰
  const inputVAT_goods    = costPrice * outputTaxRate;                      // å•†å“è¿›é¡¹ç¨é¢ï¼ˆå·²çŸ¥ä¸ºä¸å«ç¨ä»·Ã—è¿›é¡¹ç¨ç‡ï¼‰
  const inputVAT_ad       = (sellingPrice * adRate) * (SERVICE_VAT / (1 + SERVICE_VAT));      // å¹¿å‘Šè´¹å¯æŠµæ‰£éƒ¨åˆ†
  const inputVAT_platform = platformCost * (SERVICE_VAT / (1 + SERVICE_VAT));                 // å¹³å°è´¹å¯æŠµæ‰£éƒ¨åˆ†
  const inputVAT_total    = inputVAT_goods + inputVAT_ad + inputVAT_platform;
  const netTax            = outputVAT - inputVAT_total;                     // ç¨è´Ÿå‡€é¢

  // 4) æ€»æˆæœ¬ï¼ˆæ³¨æ„ï¼šadCostã€platformCostæ˜¯å«ç¨é‡‘é¢ï¼Œæ­¤å¤„æŒ‰"æ˜¾æ€§æ”¯å‡º"å£å¾„ç›¸åŠ ï¼‰
  const totalCost = goodsCost + fixCost + adCost + platformCost;

  // 5) åˆ©æ¶¦ï¼ˆæ¯ä¸ªæœ‰æ•ˆæˆäº¤ï¼‰
  const profit = sellingPrice - totalCost - netTax;

  return {
    profit,
    breakdown: {
      E, goodsCost, fixCost, adCost, platformCost,
      outputVAT, inputVAT_total, netTax
    }
  };
}
```

**è¿”å›å€¼**ï¼š
- `profit`ï¼šåˆ©æ¶¦é‡‘é¢
- `breakdown`ï¼šè¯¦ç»†è®¡ç®—è¿‡ç¨‹

## ğŸ¯ ä¿æœ¬è®¡ç®—å‡½æ•°

### å‡½æ•°åï¼š`calculateBreakeven`  **å‡è®¾å**

**åŠŸèƒ½**ï¼šè®¡ç®—ä¿æœ¬å¹¿å‘Šå æ¯”å’Œä¿æœ¬ROI

**è®¡ç®—é€»è¾‘**ï¼š

```javascript
/**
 * ä¿æœ¬å¹¿å‘Šå æ¯”ï¼ˆa*ï¼Œå®šä¹‰ä¸º"å«ç¨å¹¿å‘Šè´¹ / å«ç¨æˆäº¤é¢"ï¼‰ä¸ ä¿æœ¬ ROIï¼ˆE/a*ï¼‰
 * è¯´æ˜ï¼šå…¨éƒ¨ä»ä¸å«ç¨æ–¹ç¨‹æ¨å¯¼ï¼Œå†ç”¨ (1+6%) åšç¨åˆ¶æ¡¥å›åˆ°"å«ç¨å æ¯”"å£å¾„
 */
function calculateBreakeven(params) {
  const {
    costPrice,
    inputTaxRate,
    sellingPrice,
    salesTaxRate,
    platformRate,
    shippingCost,
    shippingInsurance,
    otherCost,
    returnRate
  } = params;

  const P = sellingPrice;
  const tOut = salesTaxRate;
  const v = SERVICE_VAT;
  const alpha = platformRate;
  const E = 1 - returnRate;

  // æˆæœ¬ï¼ˆä¸å«ç¨ï¼‰ï¼šè¿›è´§å‡€æˆæœ¬ + å›ºå®šæˆæœ¬ï¼ˆæŒ‰æœ‰æ•ˆç‡æ‘Šï¼‰
  const goodsCost = costPrice * (1 + inputTaxRate);
  const fixCost   = (shippingCost + shippingInsurance + otherCost) / E;
  const C = goodsCost + fixCost;                 // ä¸å«ç¨æˆæœ¬é‡‘é¢
  const k = C / P;                               // ä¸å«ç¨æˆæœ¬å å”®ä»·çš„æ¯”ä¾‹

  // ä¸å«ç¨æ”¶å…¥ç³»æ•° ä¸ ä½£é‡‘ä¸å«ç¨ç³»æ•°
  const revenueCoeff = 1 / (1 + tOut);           // å«ç¨å”®ä»· -> ä¸å«ç¨æ”¶å…¥çš„ç³»æ•°
  const commissionCoeff = alpha / (1 + v);       // å«ç¨æŠ½æˆ -> ä¸å«ç¨æŠ½æˆçš„ç³»æ•°

  // å…³é”®é¡¹ï¼ˆä¸å«ç¨æ–¹ç¨‹ä¸­çš„"ç©ºé—´"ï¼‰
  const term = revenueCoeff - commissionCoeff - k;

  // term <= 0 è¡¨ç¤ºä¿æœ¬ä¸å¯èƒ½ï¼ˆæˆæœ¬å·²åæ²¡æ”¶å…¥ï¼‰
  if (term <= 0) {
    return { 
      breakevenAdRate: NaN, 
      breakevenROI: NaN, 
      feasible: false, 
      debug: { term, E, k, revenueCoeff, commissionCoeff } 
    };
  }

  // å«ç¨å¹¿å‘Šå æ¯” a*ï¼ˆç¨åˆ¶æ¡¥ï¼šÃ—(1+v)ï¼‰ï¼Œå†é™¤ä»¥ Eï¼ˆå› ä¸ºå¹¿å‘ŠæŒ‰æˆäº¤è®¡ï¼Œä½†æˆ‘ä»¬åœ¨æ–¹ç¨‹é‡ŒæŒ‰ä¸å«ç¨å†™åœ¨ EÂ·â€¦ é‡Œï¼‰
  // æœ€ç»ˆï¼ša* = (1+v) * E * term
  const breakevenAdRate = (1 + v) * E * term;

  // ä¿æœ¬ ROIï¼ˆæŒ‰"æœ‰æ•ˆGMV/å«ç¨å¹¿å‘Šè´¹"ï¼‰ï¼šROI* = E / a*
  const breakevenROI = E / breakevenAdRate;

  return {
    breakevenAdRate,  // ä¿æœ¬å¹¿å‘Šå æ¯”ï¼ˆå«ç¨ï¼‰
    breakevenROI,     // ä¿æœ¬ ROI
    feasible: true,
    debug: { term, E, k, revenueCoeff, commissionCoeff }
  };
}
```

**è¿”å›å€¼**ï¼š
- `breakevenAdRate`ï¼šä¿æœ¬å¹¿å‘Šå æ¯”ï¼ˆå«ç¨ï¼‰
- `breakevenROI`ï¼šä¿æœ¬ROI
- `feasible`ï¼šæ˜¯å¦å¯è¡Œ
- `debug`ï¼šè°ƒè¯•ä¿¡æ¯

## ğŸ”„ èšåˆè®¡ç®—å‡½æ•°

### å‡½æ•°åï¼š`calculateAll`  **å‡è®¾å**

**åŠŸèƒ½**ï¼šä¸€æ¬¡è¿”å›åˆ©æ¶¦å’Œä¿æœ¬æŒ‡æ ‡

```javascript
/**
 * èšåˆï¼šä¸€æ¬¡è¿”å›åˆ©æ¶¦ + ä¿æœ¬æŒ‡æ ‡
 */
function calculateAll(params) {
  const profitPart = calculateProfit(params);
  const bePart = calculateBreakeven(params);
  return { ...profitPart, ...bePart };
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### æ ‡å‡†å‚æ•°ç¤ºä¾‹

```javascript
const params = {
  costPrice: 38,           // è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰
  inputTaxRate: 0.06,      // å¼€ç¥¨æˆæœ¬æ¯”ä¾‹ 6%
  outputTaxRate: 0.13,     // å•†å“è¿›é¡¹ç¨ç‡ 13%
  sellingPrice: 100,       // å”®ä»·ï¼ˆå«ç¨ï¼‰
  salesTaxRate: 0.13,      // é”€é¡¹ç¨ç‡ 13%
  platformRate: 0.055,     // å¹³å°ä½£é‡‘ç‡ 5.5%
  adRate: 0.20,            // å¹¿å‘Šè´¹å æ¯” 20%
  shippingCost: 2.8,       // ç‰©æµè´¹
  shippingInsurance: 1.5,  // è¿è´¹é™©
  otherCost: 2.5,          // å…¶ä»–æˆæœ¬
  returnRate: 0.20          // é€€è´§ç‡ 20%
};

// è®¡ç®—æ‰€æœ‰æŒ‡æ ‡
const results = calculateAll(params);
console.log('åˆ©æ¶¦:', results.profit);
console.log('ä¿æœ¬å¹¿å‘Šå æ¯”:', results.breakevenAdRate);
console.log('ä¿æœ¬ROI:', results.breakevenROI);
```

## âš ï¸ é‡è¦è¯´æ˜ä¸æ ¡éªŒè¦ç‚¹

### 1. æˆæœ¬è®¡ç®—è§„åˆ™
- **`goodsCost = costPrice * (1 + inputTaxRate)`**ï¼šä¸å†å‡è¿›é¡¹ç¨ï¼Œè¿™æ˜¯å®é™…æ”¯ä»˜ç»™ä¾›åº”å•†çš„é‡‘é¢
- **å›ºå®šæˆæœ¬ä¸å¹¿å‘Šè´¹**ï¼šéƒ½ç”¨ `/E` åšé€€è´§æ‘Šé”€ï¼Œå› ä¸ºæ˜¯ä¸å¯é€€å›æˆæœ¬
- **å¹³å°ä½£é‡‘**ï¼šä¸ç”¨æ‘Šé”€ï¼Œå› ä¸ºå¯é€€å›

### 2. è¿›é¡¹ç¨æŠµæ‰£è§„åˆ™
- **å•†å“è¿›é¡¹ç¨**ï¼š`costPrice * outputTaxRate`
- **å¹¿å‘Šè´¹è¿›é¡¹ç¨**ï¼š`(sellingPrice * adRate) * (0.06 / 1.06)`
- **å¹³å°è´¹è¿›é¡¹ç¨**ï¼š`platformCost * (0.06 / 1.06)`
- **æ³¨æ„**ï¼šé‡‘é¢åˆ«ç”¨æ¯”ä¾‹ï¼Œè¦ç”¨å®é™…é‡‘é¢

### 3. ä¿æœ¬è®¡ç®—è§„åˆ™
- **ä¿æœ¬å¹¿å‘Šå æ¯”**ï¼š`a* = (1+6%) * E * ( 1/(1+t_out) âˆ’ Î±/(1+6%) âˆ’ C/P )`
- **ä¿æœ¬ROI**ï¼š`ROI* = E / a*`
- **å¯è¡Œæ€§åˆ¤æ–­**ï¼šè‹¥ `term â‰¤ 0`ï¼Œç›´æ¥è¿”å›ä¸å¯ä¿æœ¬ï¼ˆ`feasible: false`ï¼‰

### 4. ç¨åˆ¶æ¡¥æ¥
- æ‰€æœ‰è®¡ç®—éƒ½åŸºäºä¸å«ç¨æ–¹ç¨‹æ¨å¯¼
- æœ€åç”¨ `(1+6%)` åšç¨åˆ¶æ¡¥å›åˆ°"å«ç¨å æ¯”"å£å¾„
- ç¡®ä¿ä¸ç³»ç»Ÿç°æœ‰è®¡ç®—é€»è¾‘å®Œå…¨ä¸€è‡´

## ğŸ” å­—æ®µå¯¹ç…§è¡¨

| å‡½æ•°å‚æ•° | ç³»ç»Ÿå­—æ®µID | ä¸­æ–‡åç§° | è¯´æ˜ |
|-----------|------------|----------|------|
| `costPrice` | `costPrice` | è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰ | åŸºç¡€è¿›è´§æˆæœ¬ |
| `inputTaxRate` | `inputTaxRate` | å¼€ç¥¨æˆæœ¬æ¯”ä¾‹ | ä¾›åº”å•†å¼€ç¥¨é¢å¤–è´¹ç”¨ |
| `outputTaxRate` | `outputTaxRate` | å•†å“è¿›é¡¹ç¨ç‡ | å¯æŠµæ‰£çš„å•†å“è¿›é¡¹ç¨ç‡ |
| `sellingPrice` | `sellingPrice` | å”®ä»·ï¼ˆå«ç¨ï¼‰ | å®é™…é”€å”®ä»·æ ¼ |
| `salesTaxRate` | `salesTaxRate` | é”€é¡¹ç¨ç‡ | é”€å”®æ—¶çš„å¢å€¼ç¨ç‡ |
| `platformRate` | `platformRate` | å¹³å°ä½£é‡‘ç‡ | å¹³å°æŠ½ä½£æ¯”ä¾‹ |
| `adRate` | `adRate` | å¹¿å‘Šè´¹å æ¯” | å…¨åº—ä»˜è´¹æ¨å¹¿å æ¯” |
| `shippingCost` | `shippingCost` | ç‰©æµè´¹ | æ¯å•ç‰©æµæˆæœ¬ |
| `shippingInsurance` | `shippingInsurance` | è¿è´¹é™© | æ¯å•è¿è´¹ä¿é™©è´¹ |
| `otherCost` | `otherCost` | å…¶ä»–æˆæœ¬ | åŒ…è£…ææ–™ç­‰å›ºå®šæˆæœ¬ |
| `returnRate` | `returnRate` | é€€è´§ç‡ | é¢„æœŸé€€è´§ç‡ |

## ğŸ“ˆ è®¡ç®—æµç¨‹æ€»ç»“

1. **åˆ©æ¶¦è®¡ç®—**ï¼šåŸºäºå®é™…å”®ä»·ï¼Œè®¡ç®—å„é¡¹æˆæœ¬å’Œç¨è´Ÿï¼Œå¾—å‡ºå‡€åˆ©æ¶¦
2. **ä¿æœ¬åˆ†æ**ï¼šä»ä¸å«ç¨æ–¹ç¨‹æ¨å¯¼ï¼Œè®¡ç®—ä¿æœ¬æ‰€éœ€çš„å¹¿å‘Šå æ¯”å’ŒROIé˜ˆå€¼
3. **ç¨åˆ¶å¤„ç†**ï¼šç»Ÿä¸€ä½¿ç”¨6%çš„æœåŠ¡ä¸šç¨ç‡è¿›è¡Œè¿›é¡¹ç¨æŠµæ‰£è®¡ç®—
4. **æˆæœ¬åˆ†æ‘Š**ï¼šä¸å¯é€€å›æˆæœ¬æŒ‰æœ‰æ•ˆç‡åˆ†æ‘Šï¼Œå¯é€€å›æˆæœ¬ä¸å‚ä¸åˆ†æ‘Š

## ğŸš€ æ‰©å±•åº”ç”¨

è¿™äº›å‡½æ•°å¯ä»¥ç”¨äºï¼š
- å®æ—¶åˆ©æ¶¦ç›‘æ§
- å¹¿å‘ŠæŠ•æ”¾ç­–ç•¥ä¼˜åŒ–
- å®šä»·ç­–ç•¥åˆ¶å®š
- æˆæœ¬ç»“æ„åˆ†æ
- æ‰¹é‡äº§å“è®¡ç®—

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´  
**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ  
**é€‚ç”¨ç³»ç»Ÿ**: E-commerce Rational Pricing Calculator
