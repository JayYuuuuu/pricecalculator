# 主页面价格指标浮窗功能添加说明

## 功能概述

在主页面价格指标模块的加价倍率和毛利率卡片上添加了鼠标悬停浮窗功能，用户可以通过鼠标悬停查看详细的计算过程，提升系统的透明度和用户体验。

## 功能特点

### 1. 交互方式
- **鼠标悬停显示**：将鼠标悬停在加价倍率或毛利率卡片上即可显示浮窗
- **鼠标离开隐藏**：鼠标离开卡片区域时浮窗自动隐藏
- **实时计算**：浮窗内容基于当前输入参数实时计算，确保数据准确性

### 2. 视觉设计
- **统一样式**：使用与税费占比浮窗完全相同的视觉样式，保持系统一致性
- **深色主题**：使用深色半透明背景，确保在各种页面背景下都有良好的可读性
- **简洁布局**：去除蓝色标题，使用简洁的文本布局，与税费占比浮窗保持一致
- **圆角阴影**：现代化的圆角设计和阴影效果，提升视觉体验

### 3. 智能定位
- **跟随鼠标移动**：浮窗实时跟随鼠标移动，提供流畅的交互体验
- **统一偏移量**：使用与税费占比浮窗相同的12px偏移量，保持一致性
- **平滑过渡**：浮窗位置变化有平滑的过渡效果，提升用户体验

## 样式统一改进

### 1. 与税费占比浮窗保持一致

为了提升系统的整体一致性和用户体验，价格指标浮窗现在使用与税费占比浮窗完全相同的样式：

- **视觉样式**：相同的背景色、字体大小、内边距、圆角和阴影效果
- **交互行为**：相同的透明度过渡动画和鼠标跟随行为
- **层级管理**：使用相同的z-index值，确保浮窗层级一致
- **偏移设置**：使用相同的12px偏移量，保持位置一致性

### 2. 跟随鼠标移动功能

价格指标浮窗现在具备与税费占比浮窗相同的跟随鼠标移动功能：

- **实时跟随**：浮窗位置实时跟随鼠标移动，提供流畅的交互体验
- **事件管理**：动态添加和清理鼠标移动事件监听器，确保性能优化
- **平滑过渡**：位置变化有平滑的过渡效果，避免突兀的跳跃

## 技术实现

### 1. HTML结构修改

为加价倍率和毛利率卡片添加了鼠标事件和样式：

```html
<!-- 加价倍率卡片 -->
<div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center; cursor: help;" 
     data-tooltip="加价倍率计算过程" 
     onmouseenter="showPriceMetricTooltip(event, 'multiple')" 
     onmouseleave="hidePriceMetricTooltip()">
    <!-- 卡片内容 -->
</div>

<!-- 毛利率卡片 -->
<div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center; cursor: help;" 
     data-tooltip="毛利率计算过程" 
     onmouseenter="showPriceMetricTooltip(event, 'gross')" 
     onmouseleave="hidePriceMetricTooltip()">
    <!-- 卡片内容 -->
</div>
```

### 2. JavaScript函数实现

#### 主要函数

**`showPriceMetricTooltip(event, metricType)`**
- 显示价格指标计算过程浮窗
- 参数：`event` - 鼠标事件对象，`metricType` - 指标类型（'multiple' 或 'gross'）

**`hidePriceMetricTooltip()`**
- 隐藏价格指标计算过程浮窗

#### 核心功能

1. **数据获取**：从页面输入框获取当前的计算参数
2. **实时计算**：基于当前参数计算进货实际成本等中间值
3. **内容生成**：根据指标类型生成相应的计算过程说明
4. **浮窗创建**：动态创建浮窗元素并设置与税费占比浮窗完全相同的样式
5. **跟随鼠标**：浮窗实时跟随鼠标移动，提供流畅的交互体验

### 3. 计算过程展示

#### 加价倍率计算过程

```
加价倍率 = 含税售价 ÷ 进货实际成本

具体计算：
• 含税售价：¥79.80
• 进货价（不含税）：¥35.00
• 开票成本：¥35.00 × 6.0% = ¥2.10
• 进货实际成本：¥35.00 + ¥2.10 = ¥37.10

加价倍率 = ¥79.80 ÷ ¥37.10 = 2.15倍
```

#### 毛利率计算过程

```
毛利率 = (含税售价 - 进货实际成本) ÷ 含税售价 × 100%

具体计算：
• 含税售价：¥79.80
• 进货价（不含税）：¥35.00
• 开票成本：¥35.00 × 6.0% = ¥2.10
• 进货实际成本：¥35.00 + ¥2.10 = ¥37.10

毛利率 = (¥79.80 - ¥37.10) ÷ ¥79.80 × 100%
      = ¥42.70 ÷ ¥79.80 × 100%
      = 53.51%
```

## 样式配置

### 浮窗样式属性

```javascript
Object.assign(tooltip.style, {
    position: 'fixed',                    // 固定定位
    zIndex: '10001',                     // 层级设置，与税费占比浮窗保持一致
    padding: '8px 10px',                 // 内边距，与税费占比浮窗保持一致
    borderRadius: '8px',                  // 圆角
    background: 'rgba(17,24,39,0.92)',   // 深色半透明背景，与税费占比浮窗保持一致
    color: '#fff',                        // 白色文字
    fontSize: '12px',                     // 字体大小，与税费占比浮窗保持一致
    lineHeight: '1.4',                    // 行高，与税费占比浮窗保持一致
    boxShadow: '0 4px 16px rgba(0,0,0,0.25)', // 阴影效果，与税费占比浮窗保持一致
    pointerEvents: 'none',                // 禁用鼠标事件，避免干扰
    whiteSpace: 'pre',                    // 保持换行格式
    transition: 'opacity .08s ease',      // 透明度过渡动画，与税费占比浮窗保持一致
    opacity: '0',                         // 初始透明度为0，实现淡入效果
    maxWidth: '400px'                     // 最大宽度
});
```

### 内容布局

```html
// 简洁的文本布局，与税费占比浮窗保持一致
`${tooltipTitle}

${tooltipContent}`
```

## 用户体验优化

### 1. 交互反馈
- **鼠标指针变化**：悬停时显示 `cursor: help`，提示用户可以查看帮助信息
- **即时显示**：鼠标悬停后立即显示浮窗，无需等待
- **跟随鼠标**：浮窗实时跟随鼠标移动，提供流畅的交互体验
- **平滑过渡**：浮窗显示和隐藏都有平滑的透明度过渡效果

### 2. 信息层次
- **统一样式**：使用与税费占比浮窗完全相同的视觉样式和布局
- **步骤清晰**：计算过程按步骤清晰展示，便于理解
- **数值精确**：所有数值都保留适当的小数位数，确保准确性

### 3. 边界处理
- **跟随鼠标**：浮窗实时跟随鼠标移动，始终保持在鼠标附近
- **统一偏移**：使用与税费占比浮窗相同的12px偏移量
- **响应式设计**：适应不同屏幕尺寸和分辨率

## 使用说明

### 1. 查看加价倍率计算过程
1. 将鼠标悬停在"加价倍率"卡片上
2. 浮窗会显示详细的加价倍率计算过程
3. 包括进货价、开票成本、进货实际成本等中间计算步骤
4. 最终显示加价倍率的计算结果

### 2. 查看毛利率计算过程
1. 将鼠标悬停在"毛利率"卡片上
2. 浮窗会显示详细的毛利率计算过程
3. 包括所有相关的计算步骤和中间值
4. 最终显示毛利率的百分比结果

### 3. 注意事项
- 浮窗内容基于当前页面输入参数实时计算
- 如果输入参数无效或为空，浮窗不会显示
- 浮窗会自动调整位置，确保在屏幕可视区域内显示

## 技术优势

### 1. 性能优化
- **按需创建**：浮窗只在需要时创建，避免不必要的DOM元素
- **事件委托**：使用内联事件处理器，减少事件监听器数量
- **内存管理**：浮窗隐藏时自动清理DOM元素，避免内存泄漏

### 2. 兼容性
- **现代浏览器**：支持所有现代浏览器
- **响应式设计**：适应不同屏幕尺寸和分辨率
- **无障碍访问**：提供清晰的视觉反馈和交互提示

### 3. 可维护性
- **模块化设计**：浮窗功能独立封装，便于维护和扩展
- **参数化配置**：样式和内容都可以通过参数配置
- **错误处理**：包含完善的错误处理机制，确保系统稳定性

## 总结

通过在主页面价格指标卡片上添加鼠标悬停浮窗功能，显著提升了系统的透明度和用户体验。用户可以：

1. **直观了解计算过程**：通过浮窗查看详细的计算步骤和中间值
2. **验证计算结果**：对照浮窗中的计算过程验证结果的正确性
3. **学习计算方法**：理解加价倍率和毛利率的计算逻辑和公式

这个功能不仅提升了系统的专业性，也增强了用户对计算结果的信任度，是一个有价值的用户体验改进。
