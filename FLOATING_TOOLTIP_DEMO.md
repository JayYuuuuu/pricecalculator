# 商品清单概览 - 计算过程浮窗功能演示

## 功能说明

新增的计算过程浮窗功能允许用户通过鼠标悬停来查看每个关键指标的具体计算过程，帮助验证数据的准确性和理解计算逻辑。

## 使用方法

### 1. 触发浮窗
- 在概览分析弹窗中，将鼠标悬停在任意指标数值上
- 鼠标指针会变为帮助样式（cursor: help）
- 浮窗会自动显示，展示详细的计算过程

### 2. 浮窗内容
每个指标的浮窗都包含：
- **计算过程标题**：明确说明当前查看的指标类型
- **计算公式**：展示具体的数学计算逻辑
- **计算逻辑**：详细说明数据处理规则和参数设置
- **当前数据**：显示实际的计算结果和统计信息

## 支持的指标类型

### 1. 平均加价率
```
平均加价率 = 所有商品加价率的总和 ÷ 有效商品数量

计算逻辑：
• 加价率 = 售价 ÷ 进货价
• 优先使用多档售价的第一档，否则使用单一售价
• 优先使用多档进货价的第一档，否则使用单一进货价
• 过滤掉售价或进货价无效的商品

当前数据：
• 有效商品数量：25
• 平均加价率：2.15倍
• 计算范围：整体
```

### 2. 平均毛利率
```
平均毛利率 = 所有商品毛利率的总和 ÷ 有效商品数量

计算逻辑：
• 毛利率 = (售价 - 进货价) ÷ 售价 × 100%
• 优先使用多档售价的第一档，否则使用单一售价
• 优先使用多档进货价的第一档，否则使用单一进货价
• 过滤掉售价或进货价无效的商品

当前数据：
• 有效商品数量：25
• 平均毛利率：53.49%
• 计算范围：整体
```

### 3. 平均退货率
```
平均退货率 = 所有商品退货率的总和 ÷ 有效商品数量

计算逻辑：
• 退货率支持多种格式：百分比字符串（如"12%"）、小数（如0.12）、数值（如12）
• 系统自动统一转换为小数格式进行计算
• 过滤掉退货率无效的商品

当前数据：
• 有效商品数量：25
• 平均退货率：12.34%
• 计算范围：整体
```

### 4. 平均保本ROI
```
平均保本ROI = 所有商品保本ROI的总和 ÷ 有效商品数量

计算逻辑：
• 使用系统现有的保本ROI计算函数
• 默认参数：开票成本6%、进项税率13%、销项税率13%
• 物流成本2.8元/单、运费险1.5元/单、其他成本2.5元/单
• 平台佣金率根据平台名称自动获取
• 过滤掉计算结果无效的商品

当前数据：
• 有效商品数量：25
• 平均保本ROI：4.67
• 计算范围：整体
```

### 5. 平均保本广告占比
```
平均保本广告占比 = 所有商品保本广告占比的总和 ÷ 有效商品数量

计算逻辑：
• 使用系统现有的保本ROI计算逻辑
• 默认参数：开票成本6%、进项税率13%、销项税率13%
• 物流成本2.8元/单、运费险1.5元/单、其他成本2.5元/单
• 平台佣金率根据平台名称自动获取
• 过滤掉计算结果无效的商品
• 风险识别：保本广告占比 < 21% 的商品标记为风险商品

当前数据：
• 有效商品数量：25
• 平均保本广告占比：18.75%
• 风险商品数量：3
• 计算范围：整体
```

## 浮窗特性

### 1. 智能定位
- 自动检测视口边界，避免浮窗超出屏幕
- 优先显示在鼠标上方，空间不足时自动调整到下方
- 左右位置智能调整，确保完整显示

### 2. 跟随鼠标
- 浮窗会跟随鼠标移动，提供更好的用户体验
- 鼠标离开指标区域时自动隐藏浮窗

### 3. 样式设计
- 半透明深色背景，确保在各种界面下都清晰可见
- 圆角边框和阴影效果，提升视觉体验
- 合适的字体大小和行间距，便于阅读

## 技术实现

### 1. 事件绑定
- 使用 `onmouseover` 和 `onmouseout` 事件
- 动态添加 `mousemove` 事件实现跟随效果
- 自动清理事件监听器，避免内存泄漏

### 2. 数据传递
- 通过HTML属性传递指标数据和类型信息
- 使用JSON序列化确保数据完整性
- 处理HTML转义字符，确保数据正确解析

### 3. 浮窗管理
- 全局唯一的浮窗ID，避免重复创建
- 显示前自动移除已存在的浮窗
- 智能的位置计算和边界检测

## 使用场景

### 1. 数据验证
- 运营人员可以快速验证计算结果的合理性
- 财务人员可以了解具体的计算逻辑和参数设置
- 管理层可以通过计算过程理解数据来源

### 2. 培训学习
- 新员工可以通过浮窗学习各项指标的计算方法
- 业务人员可以理解不同参数对结果的影响
- 技术人员可以验证系统计算的准确性

### 3. 问题排查
- 当数据异常时，可以通过计算过程快速定位问题
- 支持不同平台数据的对比分析
- 帮助识别数据输入错误或计算逻辑问题

## 注意事项

### 1. 性能考虑
- 浮窗内容动态生成，确保响应速度
- 事件监听器及时清理，避免性能影响
- 浮窗样式使用CSS优化，减少重绘

### 2. 兼容性
- 支持现代浏览器的鼠标事件
- 响应式设计，适配不同屏幕尺寸
- 浮窗样式使用标准CSS属性，确保兼容性

### 3. 用户体验
- 浮窗显示有适当的延迟，避免误触发
- 提供清晰的视觉反馈（鼠标样式变化）
- 浮窗内容结构清晰，便于快速理解

---

**功能版本**：v1.1  
**更新日期**：2024-12-19  
**新增特性**：计算过程浮窗验证功能
