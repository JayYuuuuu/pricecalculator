# 到手价推演功能说明

## 功能概述

到手价推演是一个独立的tab页面，专门用于计算在不同退货率和付费占比下，达到目标利润率所需的到手价。这个功能从商品清单页面的利润推演弹窗中提取出来，提供了更直观的界面和实时计算能力。

## 主要特性

### 1. 参数输入
支持输入以下参数（按系统默认顺序）：
- **进货价（不含税）**：供应商提供的不含税商品价格
- **开票成本（%）**：供应商开具发票时收取的额外费用比例
- **进项税率（%）**：商品的进项税率，用于计算可抵扣的进项税额
- **平台佣金（%）**：电商平台收取的交易佣金
- **销项税率（%）**：销售时的增值税税率
- **物流费（元/单）**：每个订单的快递费用
- **运费险（元/单）**：每个订单的运费险费用
- **其他成本（元/单）**：包装材料等其他固定成本

### 2. 推演参数设置
- **退货率范围**：设置退货率的推演范围（默认10%~30%）
- **付费占比范围**：设置付费占比的推演范围（默认0%~40%）

### 3. 目标利润率
系统支持以下目标利润率的推演：
- 0.0%（保本）
- 3.0%
- 5.0%
- 7.0%
- 9.0%
- 10.0%
- 12.0%
- 15.0%

### 4. 实时计算
- 输入参数后自动触发计算（500ms延迟）
- 支持参数保存到localStorage
- 计算结果实时更新

## 使用方法

### 1. 访问功能
1. 在主页面的tab导航中点击"到手价推演"
2. 系统会自动加载上次保存的参数或使用默认值

### 2. 设置参数
1. 在"基础成本"区域设置进货价、开票成本、进项税率
2. 在"销售环节费用"区域设置平台佣金、销项税率、物流费、运费险、其他成本
3. 在"推演参数设置"区域设置退货率和付费占比的推演范围

### 3. 查看结果
1. 点击"开始推演计算"按钮或等待自动计算
2. 系统会为每个退货率生成一个结果表格
3. 表格行显示付费占比，列显示目标利润率，单元格显示对应的到手价

## 结果解读

### 1. 表格结构
- **行**：付费占比（0%、5%、10%、15%、20%、25%、30%、35%、40%）
- **列**：目标利润率（0%、3%、5%、7%、9%、10%、12%、15%）
- **单元格**：达到目标利润率所需的到手价

### 2. 颜色标识
- **绿色**：正数到手价（可实现目标利润率）
- **红色**：负数到手价（无法实现目标利润率）
- **高亮行**：20%付费占比行会高亮显示，便于快速识别

### 3. 工具提示
鼠标悬停在单元格上可查看详细信息：
- 目标利润率
- 付费占比
- 退货率
- 到手价

## 计算原理

### 1. 核心算法
使用二分查找法，基于目标利润率和已知参数，反推计算到手价：
1. 从成本价开始，逐步调整价格
2. 使用统一的利润计算函数计算实际利润率
3. 比较实际利润率与目标利润率的差异
4. 通过二分查找找到最优价格

### 2. 计算函数
使用与"利润率计算"tab完全一致的`calculateProfitUnified`函数，确保计算结果的一致性。

### 3. 精度控制
- 最大迭代次数：20次
- 精度要求：利润率差异小于0.001（0.1%）

## 应用场景

### 1. 价格策略制定
- 了解不同营销投入下的定价要求
- 评估退货率对定价的影响
- 制定合理的利润率目标

### 2. 成本控制分析
- 分析各项成本对定价的影响
- 优化成本结构
- 制定成本控制目标

### 3. 营销预算规划
- 根据付费占比确定合理的定价策略
- 平衡营销投入与利润目标
- 制定ROI目标

## 注意事项

### 1. 参数合理性
- 进货价必须大于0
- 退货率最小值不能大于最大值
- 付费占比最小值不能大于最大值

### 2. 计算限制
- 系统会限制价格上限为成本的10倍
- 如果无法达到目标利润率，可能返回负数或NaN

### 3. 性能考虑
- 输入参数变化后会有500ms的延迟计算
- 避免频繁修改参数以提升性能

## 技术实现

### 1. 前端技术
- HTML5 + CSS3 + JavaScript ES6+
- 响应式设计，支持移动端
- 实时计算和参数保存

### 2. 核心函数
- `calculateTakeHomePriceExploration()`：主计算函数
- `calculateTakeHomePriceForExploration()`：到手价计算
- `generateRangePoints()`：范围点生成
- `displayTakeHomePriceResults()`：结果展示

### 3. 数据存储
- 使用localStorage保存用户输入参数
- 支持参数自动恢复

## 更新日志

- **v1.0**：初始版本，提取自商品清单利润推演弹窗
- 支持8个目标利润率的推演
- 支持自定义退货率和付费占比范围
- 实现实时计算和参数保存
