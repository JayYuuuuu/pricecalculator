<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç”µå•†åˆç†å”®ä»·è®¡ç®—å™¨ï¼ˆç¨åŠ¡åˆè§„ç‰ˆï¼‰</title>
    <style>
        /* Tabåˆ‡æ¢æ ·å¼ */
        .tab-container {
            margin-bottom: 2rem;
        }
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid #d2d2d7;
            padding-bottom: 0.5rem;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background: none;
            border: none;
            color: #666;
        }
        .tab:hover {
            background: #f5f5f7;
            color: #1d1d1f;
        }
        .tab.active {
            background: #0066cc;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* ç°ä»£åŒ–çš„UIæ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: #f5f5f7;
            color: #333;
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 
                       0 8px 24px rgba(0, 0, 0, 0.04);
        }
        h2 {
            color: #1d1d1f;
            margin-bottom: 2rem;
            text-align: center;
            font-weight: 500;
        }
        .section {
            background: #ffffff;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .section h3 {
            color: #1d1d1f;
            font-size: 1.1rem;
            margin: 0 0 1.5rem 0;
            font-weight: 500;
        }
        .input-groups-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        .input-group {
            margin-bottom: 0;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        label {
            display: block;
            margin-bottom: 0.35rem;
            color: #1d1d1f;
            font-weight: 400;
            font-size: 0.9rem;
        }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d2d2d7;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background-color: #fafafa;
            margin-right: 8px;
        }
        input:focus {
            border-color: #0066cc;
            outline: none;
            background-color: #ffffff;
            box-shadow: 0 0 0 3px rgba(0,102,204,0.15);
        }
        .field-hint {
            font-size: 0.8rem;
            color: #86868b;
            margin-top: 0.25rem;
            line-height: 1.2;
        }
        button {
            width: auto;
            padding: 0.75rem 1.5rem;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 1.5rem auto;
            display: block;
        }
        button:hover {
            background-color: #0077ed;
        }
        .result {
            margin-top: 2rem;
            font-size: 1rem;
        }
        .final-price {
            text-align: center;
            background: #f5f5f7;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .final-price .price-label {
            font-size: 1.2rem;
            color: #1d1d1f;
            margin-bottom: 1rem;
        }
        .final-price .price-value {
            font-size: 2.5rem;
            font-weight: 600;
            color: #0066cc;
        }
        .calculation-process {
            margin-top: 2rem;
            background: #ffffff;
        }
        .result .section {
            margin-bottom: 1.5rem;
        }
        .result .section h3 {
            color: #1d1d1f;
            font-size: 1rem;
            margin: 0 0 1rem 0;
            font-weight: 500;
        }
        .result ul {
            margin: 0.5rem 0;
            padding-left: 1.25rem;
            list-style-type: none;
        }
        .result ul li {
            margin: 0.4rem 0;
            position: relative;
        }
        .result ul li:before {
            content: "â€¢";
            color: #86868b;
            position: absolute;
            left: -1rem;
        }
        .result ul ul {
            margin: 0.35rem 0 0.35rem 0.5rem;
            color: #515154;
        }
        .result ul ul li:before {
            content: "â—¦";
        }
        .error {
            color: #ff3b30;
            padding: 1rem;
            background-color: #fff2f2;
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 0.95rem;
        }
        .description {
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: #86868b;
            padding: 1rem;
            background-color: #f5f5f7;
            border-radius: 6px;
        }
        .step-description {
            margin-bottom: 1.5rem;
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        .cost-category {
            background: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #e6e6e6;
        }
        .category-title {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .summary-title {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        .field-hint {
            color: #666;
            line-height: 1.4;
        }
        .price-hint {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        /* ä»·æ ¼æ„æˆåˆ†ææ ·å¼ */
        .price-composition {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }
        .price-composition .composition-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        /* åˆ©æ¶¦æ„æˆåˆ†ææ ·å¼ */
        .profit-composition {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }
        .profit-composition .composition-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .profit-composition .composition-item.revenue {
            grid-column: span 3;
        }
        .profit-composition .composition-item.cost {
            grid-column: span 3;
        }
        .profit-composition .composition-item.expenses {
            grid-column: span 3;
        }
        .profit-composition .composition-item.tax {
            grid-column: span 3;
        }
        .composition-item.profit {
            background: #e8f5e9;
        }
        .item-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .item-value {
            font-size: 1.2rem;
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 0.25rem;
        }
        .item-percent {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        .tax-detail {
            border-top: 1px dashed #e0e0e0;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
        .tax-item {
            color: #666;
            margin: 0.2rem 0;
            display: flex;
            justify-content: space-between;
        }
        .tax-item:last-child {
            color: #2ea44f;
            font-weight: 500;
            margin-top: 0.5rem;
        }
        .cost-detail {
            border-top: 1px dashed #e0e0e0;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
        .cost-item {
            color: #666;
            margin: 0.2rem 0;
            display: flex;
            justify-content: space-between;
        }
        .price-note {
            margin-top: 1rem;
            padding: 0.5rem;
            background: #fff3e0;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e65100;
        }
        .calculation-note {
            font-size: 0.85rem;
            color: #515154;
            margin-top: 1rem;
            border-top: 1px solid #d2d2d7;
            padding-top: 1rem;
        }
        /* è®¡ç®—æ­¥éª¤æ ·å¼ */
        .calculation-steps {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .step-header {
            font-size: 1rem;
            color: #1d1d1f;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .step-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .step-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e6e6e6;
        }
        .cost-table {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .table-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .section-title {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1rem;
        }
        .section-note {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: #fff3e0;
            border-radius: 4px;
        }
        .cost-table table {
            width: 100%;
            border-collapse: collapse;
        }
        .cost-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .cost-table td:last-child {
            text-align: right;
        }
        .cost-table .formula {
            color: #666;
            font-size: 0.9rem;
            text-align: center;
        }
        .cost-table .amount {
            font-weight: 500;
            color: #1d1d1f;
        }
        .cost-table .total {
            background: #f8f9fa;
            font-weight: 500;
        }
        .total-amount {
            font-size: 1.2rem;
            font-weight: 500;
            color: #2ea44f;
            text-align: right;
        }
        .note {
            font-size: 0.8rem;
            color: #666;
            font-weight: normal;
        }
        .formula-box {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .formula-title {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1rem;
        }
        .formula-content {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #1d1d1f;
        }
        .formula-note {
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: #666;
        }
        .calculation-details table {
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .calculation-details td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
        }
        .detail-items {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
        }
        .final-calculation {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .calc-step {
            font-family: monospace;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.75rem;
        }
        .calc-result {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2ea44f;
        }
        .final-price-calc {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .calc-formula {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 1rem;
        }
        /* é”€å”®æˆæœ¬åˆ†ææ ·å¼ */
        .sales-cost-analysis {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .analysis-header {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            line-height: 1.5;
        }
        .cost-breakdown {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .cost-item {
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 1rem;
        }
        .cost-title {
            font-weight: 500;
            color: #1d1d1f;
            margin-bottom: 0.75rem;
        }
        .cost-details {
            margin-left: 1.5rem;
        }
        .detail-row {
            margin: 0.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #666;
            font-size: 0.9rem;
        }
        .cost-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        .cost-formula {
            color: #666;
            font-size: 0.9rem;
        }
        .total-cost {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }
        .total-value {
            color: #2ea44f;
            font-size: 1.1rem;
        }
        .save-button {
            background: none;
            color: #0066cc;
            border: none;
            padding: 0.25rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: color 0.2s ease;
            width: auto;
            margin: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .save-button:hover {
            color: #0077ed;
            background: none;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-size: 0.9rem;
            z-index: 1000;
            transition: opacity 0.3s ease;
        }
        .toast-hide {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ç”µå•†åˆç†å”®ä»·è®¡ç®—å™¨ï¼ˆç¨åŠ¡åˆè§„ç‰ˆï¼‰</h2>
        
        <div class="tab-container">
            <div class="tabs">
                <button class="tab" onclick="switchTab('price')">å”®ä»·è®¡ç®—</button>
                <button class="tab active" onclick="switchTab('profit')">åˆ©æ¶¦è®¡ç®—</button>
            </div>
        </div>

        <!-- å”®ä»·è®¡ç®—tab -->
        <div id="priceTab" class="tab-content">
            <div class="section">
                <h3>ç¬¬ä¸€æ­¥ï¼šåŸºç¡€æˆæœ¬</h3>
                <div class="step-description">
                    è¿™éƒ¨åˆ†æ˜¯æ‚¨éœ€è¦æ”¯ä»˜ç»™ä¾›åº”å•†çš„è´¹ç”¨ï¼ŒåŒ…æ‹¬å•†å“æœ¬èº«çš„æˆæœ¬å’Œç›¸å…³ç¨è´¹ã€‚
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰:</label>
                        <div class="input-wrapper">
                            <input type="number" id="costPrice" value="100" step="0.01">
                            <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                        </div>
                        <div class="field-hint">è¿™æ˜¯ä¾›åº”å•†æä¾›çš„ä¸å«ç¨å•†å“ä»·æ ¼</div>
                    </div>

                    <div class="input-group">
                        <label>å¼€ç¥¨æˆæœ¬ï¼ˆ%ï¼‰:</label>
                        <div class="input-wrapper">
                            <input type="number" id="inputTaxRate" value="6" step="0.1">
                            <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                        </div>
                        <div class="field-hint">ä¾›åº”å•†å¼€å…·å‘ç¥¨æ—¶æ”¶å–çš„é¢å¤–è´¹ç”¨æ¯”ä¾‹ï¼ˆé€šå¸¸æ˜¯6%ï¼‰</div>
                    </div>

                    <div class="input-group">
                        <label>å•†å“ç¨ç‡ï¼ˆ%ï¼‰:</label>
                        <div class="input-wrapper">
                            <input type="number" id="outputTaxRate" value="13" step="0.1">
                            <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                        </div>
                        <div class="field-hint">å•†å“çš„å¢å€¼ç¨ç¨ç‡ï¼ˆå¦‚æœè£…ç±»13%ï¼‰ï¼Œè¿™éƒ¨åˆ†ç¨è´¹å°†æ¥å¯ä»¥æŠµæ‰£</div>
                    </div>
                </div>
                
                <div class="cost-summary" id="purchaseCostSummary" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                    <div class="summary-title">æˆæœ¬è®¡ç®—ç»“æœ</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>å®é™…æ”¯ä»˜æ€»é¢ï¼š</span>
                        <span id="totalPayment" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; color: #2ea44f;">
                        <span>ç¨åå®é™…æˆæœ¬ï¼š</span>
                        <span id="effectiveCost" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div class="field-hint" style="margin-top: 0.5rem; font-size: 0.8rem;">
                        <div>â€¢ å®é™…æ”¯ä»˜æ€»é¢ = è¿›è´§ä»· + å¼€ç¥¨è´¹ç”¨</div>
                        <div>â€¢ ç¨åå®é™…æˆæœ¬ = å®é™…æ”¯ä»˜æ€»é¢ - å¯æŠµæ‰£è¿›é¡¹ç¨</div>
                        <div>â€¢ å¯æŠµæ‰£è¿›é¡¹ç¨åœ¨é”€å”®æ—¶å¯ä»¥æŠµå‡åº”ç¼´ç¨æ¬¾ï¼Œç›¸å½“äºæœªæ¥çš„ç¨æ”¶ä¼˜æƒ </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>ç¬¬äºŒæ­¥ï¼šé”€å”®ç¯èŠ‚è´¹ç”¨</h3>
                <div class="step-description">
                    è¿™éƒ¨åˆ†æ˜¯åœ¨é”€å”®è¿‡ç¨‹ä¸­äº§ç”Ÿçš„å„é¡¹è´¹ç”¨ï¼ŒåŒ…æ‹¬å¹³å°è´¹ç”¨ã€ç‰©æµè´¹ç”¨å’Œè¥é”€è´¹ç”¨ã€‚
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">å¹³å°è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å¹³å°æŠ½ä½£æ¯”ä¾‹ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="platformRate" value="5.5" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">ç”µå•†å¹³å°æ”¶å–çš„äº¤æ˜“ä½£é‡‘ï¼ŒåŸºäºæœ€ç»ˆå”®ä»·ï¼ˆå«ç¨ï¼‰è®¡ç®—</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">ç‰©æµè´¹ç”¨</div>
                        <div class="input-group">
                            <label>ç‰©æµè´¹ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">æ¯ä¸ªè®¢å•çš„å¿«é€’è´¹ç”¨</div>
                        </div>

                        <div class="input-group">
                            <label>è¿è´¹é™©ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">æ¯ä¸ªè®¢å•çš„è¿è´¹é™©è´¹ç”¨</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">è¥é”€è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å¹¿å‘Šè´¹ç”¨æ¯”ä¾‹ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="adRate" value="30" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">å¹¿å‘Šè´¹å æœ€ç»ˆå”®ä»·çš„æ¯”ä¾‹ï¼Œå¯å¼€å…·6%ä¸“ç¥¨æŠµæ‰£ç¨æ¬¾</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">å…¶ä»–è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å…¶ä»–æˆæœ¬ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="otherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">åŒ…è£…ææ–™ç­‰å…¶ä»–å›ºå®šæˆæœ¬</div>
                        </div>

                        <div class="input-group">
                            <label>é”€é¡¹ç¨ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="salesTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">é”€é¡¹ç¨ç‡ï¼ˆå¦‚13%ï¼‰ã€‚æ³¨æ„ï¼šé”€é¡¹ç¨ä¸æ˜¯ç›´æ¥ç”¨å«ç¨ä»·Ã—13%ï¼Œè€Œæ˜¯è¦å…ˆå»ç¨ï¼Œå³ï¼šå«ç¨ä»·Ã·1.13Ã—13%</div>
                        </div>
                    </div>
                </div>
                
                <div class="cost-summary" id="salesCostSummary" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>å›ºå®šæˆæœ¬ï¼ˆå«é€€è´§åˆ†æ‘Šï¼‰ï¼š</span>
                        <span id="totalFixedCost" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>å¹³å°ä½£é‡‘ï¼š</span>
                        <span id="platformFeePreview" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>å¹¿å‘Šè´¹ï¼š</span>
                        <span id="adCostPreview" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>é”€é¡¹ç¨ï¼ˆ13%ï¼‰ï¼š</span>
                        <span id="salesTax" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; color: #2ea44f;">
                        <span>æ€»é”€å”®æˆæœ¬ï¼š</span>
                        <span id="totalSalesCost" style="font-weight: 500;">Â¥0.00</span>
                    </div>
                    <div class="field-hint" style="margin-top: 0.5rem; font-size: 0.8rem;">
                        æ€»é”€å”®æˆæœ¬ = å›ºå®šæˆæœ¬ + å¹³å°ä½£é‡‘ + å¹¿å‘Šè´¹ + é”€é¡¹ç¨ï¼ˆåŸºäºæœ€ç»ˆå”®ä»·ï¼‰
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>ç¬¬ä¸‰æ­¥ï¼šç›®æ ‡è®¾å®š</h3>
                <div class="step-description">
                    è®¾ç½®æ‚¨çš„ç»è¥ç›®æ ‡å’Œé£é™©é¢„æœŸï¼Œè¿™å°†å½±å“æœ€ç»ˆå”®ä»·çš„è®¡ç®—ã€‚
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">ç»è¥ç›®æ ‡</div>
                        <div class="input-group">
                            <label>ç›®æ ‡åˆ©æ¶¦ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="targetProfitRate" value="8" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">æ‚¨æœŸæœ›çš„åˆ©æ¶¦ç‡ï¼ŒåŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—ï¼ˆä¾‹ï¼š8%æ„å‘³ç€æ¯100å…ƒå”®ä»·ä¸­æœ‰8å…ƒæ˜¯åˆ©æ¶¦ï¼‰</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">é£é™©é¢„æœŸ</div>
                        <div class="input-group">
                            <label>é¢„è®¡é€€è´§ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="returnRate" value="20" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">é¢„è®¡çš„é€€è´§ç‡ï¼Œå½±å“æˆæœ¬åˆ†æ‘Šï¼ˆä¾‹ï¼š20%æ„å‘³ç€æ¯100å•ä¸­æœ‰20å•ä¼šé€€è´§ï¼‰</div>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- ç»“æŸå”®ä»·è®¡ç®—tab -->

        <!-- åˆ©æ¶¦è®¡ç®—tab -->
        <div id="profitTab" class="tab-content active">
            <div class="section">
                <h3>åˆ©æ¶¦è®¡ç®—</h3>
                <div class="step-description">
                    è¾“å…¥å•†å“çš„è¿›è´§ä»·å’Œå®é™…å”®ä»·ï¼Œè®¡ç®—å„é¡¹æˆæœ¬å’Œæœ€ç»ˆåˆ©æ¶¦ã€‚
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰:</label>
                        <div class="input-wrapper">
                            <input type="number" id="profitCostPrice" value="100" step="0.01">
                            <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                        </div>
                        <div class="field-hint">è¿™æ˜¯ä¾›åº”å•†æä¾›çš„ä¸å«ç¨å•†å“ä»·æ ¼</div>
                    </div>

                    <div class="input-group">
                        <label>å®é™…å”®ä»·ï¼ˆå«ç¨ï¼‰:</label>
                        <div class="input-wrapper">
                            <input type="number" id="actualPrice" value="200" step="0.01">
                            <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                        </div>
                        <div class="field-hint">å®é™…é”€å”®æ—¶çš„å«ç¨ä»·æ ¼</div>
                    </div>

                    <div class="input-group">
                        <label>å®é™…åˆ©æ¶¦:</label>
                        <div class="input-wrapper" style="position: relative;">
                            <input type="text" id="actualProfit" readonly style="background-color: #f8f9fa; cursor: default;">
                            <div id="profitRate" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #2ea44f; font-size: 0.9rem;"></div>
                        </div>
                        <div class="field-hint" style="display: flex; justify-content: space-between;">
                            <span>è®¡ç®—å¾—å‡ºçš„å®é™…åˆ©æ¶¦é‡‘é¢</span>
                            <span id="profitStatus" style="font-weight: 500;"></span>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                #actualProfit {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                    font-weight: 500;
                }
                #actualProfit.profit-positive {
                    color: #2ea44f;
                }
                #actualProfit.profit-negative {
                    color: #e65100;
                }
                #profitStatus.status-good {
                    color: #2ea44f;
                }
                #profitStatus.status-bad {
                    color: #e65100;
                }
                #profitStatus.status-warning {
                    color: #f59e0b;
                }
            </style>

            <div class="section">
                <h3>è´¹ç”¨è®¾ç½®</h3>
                <div class="step-description">
                    è®¾ç½®å„é¡¹è´¹ç”¨å‚æ•°ï¼Œè¿™äº›å‚æ•°å°†å½±å“æœ€ç»ˆçš„åˆ©æ¶¦è®¡ç®—ã€‚
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">ç¨è´¹è®¾ç½®</div>
                        <div class="input-group">
                            <label>å¼€ç¥¨æˆæœ¬ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitInputTaxRate" value="6" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">ä¾›åº”å•†å¼€å…·å‘ç¥¨æ—¶æ”¶å–çš„é¢å¤–è´¹ç”¨æ¯”ä¾‹ï¼ˆé€šå¸¸æ˜¯6%ï¼‰</div>
                        </div>

                        <div class="input-group">
                            <label>å•†å“è¿›é¡¹ç¨ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOutputTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">å•†å“çš„è¿›é¡¹ç¨ç‡ï¼Œç”¨äºè®¡ç®—å¯æŠµæ‰£çš„è¿›é¡¹ç¨é¢ï¼ˆå¦‚æœè£…ç±»13%ï¼‰</div>
                        </div>

                        <div class="input-group">
                            <label>é”€é¡¹ç¨ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitSalesTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">é”€å”®æ—¶çš„å¢å€¼ç¨ç¨ç‡ï¼Œé€šå¸¸ä¸å•†å“è¿›é¡¹ç¨ç‡ç›¸åŒï¼ˆå¦‚13%ï¼‰</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">å¹³å°è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å¹³å°æŠ½ä½£æ¯”ä¾‹ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitPlatformRate" value="5.5" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">ç”µå•†å¹³å°æ”¶å–çš„äº¤æ˜“ä½£é‡‘ï¼ŒåŸºäºæœ€ç»ˆå”®ä»·ï¼ˆå«ç¨ï¼‰è®¡ç®—ã€‚å¹³å°å¼€å…·6%ä¸“ç¥¨ï¼Œå¯æŠµæ‰£è¿›é¡¹ç¨ã€‚</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            ğŸ’¡ æç¤ºï¼šå¹³å°ä½£é‡‘å¯ä»¥è·å¾—6%çš„è¿›é¡¹ç¨æŠµæ‰£ï¼Œè¿™éƒ¨åˆ†æŠµæ‰£ä¼šé™ä½å®é™…æˆæœ¬ã€‚
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">ç‰©æµè´¹ç”¨</div>
                        <div class="input-group">
                            <label>ç‰©æµè´¹ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">æ¯ä¸ªè®¢å•çš„å¿«é€’è´¹ç”¨</div>
                        </div>

                        <div class="input-group">
                            <label>è¿è´¹é™©ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">æ¯ä¸ªè®¢å•çš„è¿è´¹é™©è´¹ç”¨</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">è¥é”€è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å¹¿å‘Šè´¹ç”¨æ¯”ä¾‹ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitAdRate" value="30" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">å¹¿å‘Šè´¹å æœ€ç»ˆå”®ä»·çš„æ¯”ä¾‹ï¼Œå¹¿å‘ŠæœåŠ¡å•†å¼€å…·6%ä¸“ç¥¨ï¼Œå¯æŠµæ‰£è¿›é¡¹ç¨ã€‚</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            ğŸ’¡ æç¤ºï¼šå¹¿å‘Šè´¹ç”¨å¯ä»¥è·å¾—6%çš„è¿›é¡¹ç¨æŠµæ‰£ã€‚ç”±äºå¹¿å‘Šè´¹é‡‘é¢è¾ƒå¤§ï¼Œè¿™éƒ¨åˆ†æŠµæ‰£ä¼šæ˜¾è‘—é™ä½å®é™…è¥é”€æˆæœ¬ã€‚
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">å…¶ä»–è´¹ç”¨</div>
                        <div class="input-group">
                            <label>å…¶ä»–æˆæœ¬ï¼ˆå…ƒ/å•ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOtherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">åŒ…è£…ææ–™ç­‰å…¶ä»–å›ºå®šæˆæœ¬</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">é£é™©é¢„æœŸ</div>
                        <div class="input-group">
                            <label>é¢„è®¡é€€è´§ç‡ï¼ˆ%ï¼‰:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitReturnRate" value="20" step="0.1">
                                <button class="save-button" onclick="saveInputs()">ä¿å­˜</button>
                            </div>
                            <div class="field-hint">é¢„è®¡çš„é€€è´§ç‡ï¼Œå½±å“æˆæœ¬åˆ†æ‘Šï¼ˆä¾‹ï¼š20%æ„å‘³ç€æ¯100å•ä¸­æœ‰20å•ä¼šé€€è´§ï¼‰</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="calculateProfit()">è®¡ç®—åˆ©æ¶¦</button>
        </div>

        <div class="result" id="result"></div>
        
        <div class="description">
            <p>è®¡ç®—è¯´æ˜ï¼š</p>
            <ul>
                <li>è¿›è´§ä»·è¯·å¡«å†™ä¸å«ç¨ä»·æ ¼</li>
                <li>å¼€ç¥¨æˆæœ¬æ˜¯ä¾›åº”å•†æ”¶å–çš„å¼€ç¥¨è´¹ç”¨æ¯”ä¾‹ï¼ˆå¦‚6%ï¼‰</li>
                <li>é”€é¡¹ç¨ç‡ç”¨äºè®¡ç®—å¯æŠµæ‰£çš„è¿›é¡¹ç¨é¢ï¼ˆå¦‚æœè£…ç±»ç›®13%ï¼‰</li>
                <li>è®¡ç®—ç»“æœå·²è€ƒè™‘å¼€ç¥¨æˆæœ¬ã€ç¨è´¹æŠµæ‰£ã€å¹³å°æŠ½ä½£ç­‰</li>
                <li>ç›®æ ‡åˆ©æ¶¦ç‡åŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—</li>
            </ul>

            <p style="margin-top: 1.5rem; color: #0066cc;">é‡è¦æç¤ºï¼šå…³äºåˆ©æ¶¦ç‡è®¡ç®—</p>
            <ul style="color: #666;">
                <li>å”®ä»·è®¡ç®—æ¨¡å—ï¼š
                    <ul>
                        <li>ç›®æ ‡åˆ©æ¶¦ç‡æ˜¯é’ˆå¯¹æœ‰æ•ˆè®¢å•ï¼ˆæ‰£é™¤é€€è´§åï¼‰çš„åˆ©æ¶¦ç‡</li>
                        <li>ç³»ç»Ÿä¼šæé«˜å”®ä»·æ¥è¡¥å¿é€€è´§å¸¦æ¥çš„æŸå¤±</li>
                        <li>ç¡®ä¿æœ‰æ•ˆè®¢å•èƒ½è¾¾åˆ°è®¾å®šçš„ç›®æ ‡åˆ©æ¶¦ç‡</li>
                    </ul>
                </li>
                <li>åˆ©æ¶¦è®¡ç®—æ¨¡å—ï¼š
                    <ul>
                        <li>æ˜¾ç¤ºæ•´ä½“ä¸šåŠ¡çš„å®é™…åˆ©æ¶¦ç‡ï¼ˆåŒ…å«æ‰€æœ‰è®¢å•ï¼‰</li>
                        <li>é€šå¸¸ä¼šé«˜äºå”®ä»·è®¡ç®—çš„ç›®æ ‡åˆ©æ¶¦ç‡</li>
                        <li>è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå› ä¸ºå”®ä»·ä¸­åŒ…å«äº†é€€è´§è¡¥å¿</li>
                    </ul>
                </li>
                <li>å»ºè®®ï¼š
                    <ul>
                        <li>åŒæ—¶å‚è€ƒä¸¤ä¸ªæ¨¡å—æ¥è¯„ä¼°å®šä»·ç­–ç•¥</li>
                        <li>å¯ä»¥é€šè¿‡è°ƒæ•´ç›®æ ‡åˆ©æ¶¦ç‡æ¥è¾¾åˆ°ç†æƒ³çš„æ•´ä½“åˆ©æ¶¦æ°´å¹³</li>
                        <li>å®šæœŸæ ¹æ®å®é™…è¿è¥æ•°æ®è°ƒæ•´å‚æ•°è®¾ç½®</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Tabåˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰tabå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰tabæŒ‰é’®çš„activeçŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„tabå†…å®¹
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // è®¾ç½®é€‰ä¸­tabæŒ‰é’®çš„activeçŠ¶æ€
            event.target.classList.add('active');
            
            // æ¸…ç©ºç»“æœåŒºåŸŸ
            document.getElementById('result').innerHTML = '';
        }

        /**
         * è®¡ç®—å®é™…åˆ©æ¶¦çš„ä¸»å‡½æ•°
         * 
         * é‡è¦è¯´æ˜ï¼šåˆ©æ¶¦è®¡ç®—æ¨¡å—ä¸å”®ä»·è®¡ç®—æ¨¡å—çš„å·®å¼‚
         * 1. åˆ©æ¶¦è®¡ç®—æ¨¡å—ï¼ˆæœ¬å‡½æ•°ï¼‰
         *    - ç›®çš„ï¼šè®¡ç®—å®é™…ç»è¥çš„æ•´ä½“åˆ©æ¶¦ç‡
         *    - åŸç†ï¼šåŸºäºå®é™…å”®ä»·ï¼Œè®¡ç®—æ‰€æœ‰è®¢å•çš„å¹³å‡åˆ©æ¶¦ç‡
         *    - ç‰¹ç‚¹ï¼šæ˜¾ç¤ºçš„åˆ©æ¶¦ç‡é€šå¸¸ä¼šé«˜äºå”®ä»·è®¡ç®—æ¨¡å—çš„ç›®æ ‡åˆ©æ¶¦ç‡
         *    - ä¾‹å¦‚ï¼šå¦‚æœå”®ä»·æ˜¯åŸºäº8%ç›®æ ‡åˆ©æ¶¦ç‡è®¡ç®—çš„ï¼š
         *      Â· ç”±äºå”®ä»·ä¸­åŒ…å«äº†é€€è´§è¡¥å¿
         *      Â· å®é™…åˆ©æ¶¦ç‡å¯èƒ½ä¼šè¾¾åˆ°12-15%
         * 
         * 2. ä¸å”®ä»·è®¡ç®—æ¨¡å—çš„åŒºåˆ«
         *    - åˆ©æ¶¦è®¡ç®—ï¼šå±•ç¤ºæ•´ä½“ä¸šåŠ¡è¡¨ç°ï¼ˆæ‰€æœ‰è®¢å•çš„å¹³å‡ç»“æœï¼‰
         *    - å”®ä»·è®¡ç®—ï¼šå…³æ³¨å•ä¸ªæœ‰æ•ˆè®¢å•çš„ç›®æ ‡åˆ©æ¶¦ï¼ˆæ‰£é™¤é€€è´§å½±å“ï¼‰
         *    - å·®å¼‚åŸå› ï¼šå”®ä»·è®¡ç®—æ¨¡å—ä¼šæé«˜ä»·æ ¼æ¥è¡¥å¿é€€è´§æŸå¤±
         * 
         * 3. å®é™…åº”ç”¨è¯´æ˜
         *    - æ­¤æ¨¡å—é€‚åˆè¯„ä¼°å®é™…ç»è¥æ•ˆæœ
         *    - å¯ä»¥ç”¨æ¥éªŒè¯å®šä»·ç­–ç•¥çš„å®é™…æ•ˆæœ
         *    - å¸®åŠ©ç†è§£é€€è´§ç‡å¯¹æ•´ä½“åˆ©æ¶¦çš„å½±å“
         *    - å»ºè®®åŒæ—¶å‚è€ƒä¸¤ä¸ªæ¨¡å—æ¥åˆ¶å®šå®šä»·ç­–ç•¥
         */
        function calculateProfit() {
            try {
                // è·å–åŸºç¡€è¾“å…¥
                const costPrice = validateInput(parseFloat(document.getElementById('profitCostPrice').value), 0.01, 1000000, "è¿›è´§ä»·");
                const actualPrice = validateInput(parseFloat(document.getElementById('actualPrice').value), 0.01, 1000000, "å®é™…å”®ä»·");
                const inputTaxRate = validateInput(parseFloat(document.getElementById('profitInputTaxRate').value), 0, 100, "å¼€ç¥¨æˆæœ¬") / 100;
                const outputTaxRate = validateInput(parseFloat(document.getElementById('profitOutputTaxRate').value), 0, 100, "å•†å“è¿›é¡¹ç¨ç‡") / 100;
                const salesTaxRate = validateInput(parseFloat(document.getElementById('profitSalesTaxRate').value), 0, 100, "é”€é¡¹ç¨ç‡") / 100;
                const platformRate = validateInput(parseFloat(document.getElementById('profitPlatformRate').value), 0, 100, "å¹³å°æŠ½ä½£æ¯”ä¾‹") / 100;
                const shippingCost = validateInput(parseFloat(document.getElementById('profitShippingCost').value), 0, 10000, "ç‰©æµè´¹");
                const shippingInsurance = validateInput(parseFloat(document.getElementById('profitShippingInsurance').value), 0, 100, "è¿è´¹é™©");
                const adRate = validateInput(parseFloat(document.getElementById('profitAdRate').value), 0, 100, "å¹¿å‘Šè´¹ç”¨æ¯”ä¾‹") / 100;
                const otherCost = validateInput(parseFloat(document.getElementById('profitOtherCost').value), 0, 10000, "å…¶ä»–æˆæœ¬");
                const returnRate = validateInput(parseFloat(document.getElementById('profitReturnRate').value), 0, 100, "é€€è´§ç‡") / 100;

                // è®¡ç®—è¿›è´§æˆæœ¬
                const invoiceCost = costPrice * inputTaxRate; // å¼€ç¥¨æˆæœ¬
                const totalPurchaseCost = costPrice + invoiceCost; // æ€»è¿›è´§æˆæœ¬
                const purchaseVAT = costPrice * outputTaxRate; // è¿›é¡¹ç¨é¢
                const effectiveCost = totalPurchaseCost - purchaseVAT; // ç¨åå®é™…æˆæœ¬

                // è®¡ç®—æœ‰æ•ˆé”€å”®ç‡
                const effectiveRate = 1 - returnRate;

                // è®¡ç®—é”€å”®ç›¸å…³è´¹ç”¨ï¼ˆè€ƒè™‘é€€è´§ç‡ï¼‰
                const platformFee = actualPrice * platformRate; // å¹³å°ä½£é‡‘ï¼ˆå¯é€€å›ï¼‰
                const adCost = actualPrice * adRate; // å¹¿å‘Šè´¹ï¼ˆä¸å¯é€€å›ï¼Œéœ€åˆ†æ‘Šï¼‰
                const adCostEffective = adCost / effectiveRate; // åˆ†æ‘Šåçš„å¹¿å‘Šè´¹
                const adVAT = adCostEffective * 0.06; // å¹¿å‘Šè´¹å¯æŠµæ‰£è¿›é¡¹ç¨ï¼ˆ6%ï¼‰
                
                // è¿è¥æˆæœ¬ï¼ˆä¸å¯é€€å›ï¼Œéœ€åˆ†æ‘Šï¼‰
                const operationalCostBase = shippingCost + shippingInsurance + otherCost;
                const operationalCost = operationalCostBase / effectiveRate;

                // è®¡ç®—é”€é¡¹ç¨
                const netPrice = actualPrice / (1 + salesTaxRate); // ä¸å«ç¨å”®ä»·
                const outputVAT = netPrice * salesTaxRate; // é”€é¡¹ç¨é¢

                // è®¡ç®—æ€»å¯æŠµæ‰£è¿›é¡¹ç¨
                const totalVATDeduction = purchaseVAT + adVAT + (platformFee * 0.06); // å•†å“+å¹¿å‘Š+å¹³å°ä½£é‡‘çš„è¿›é¡¹ç¨
                const actualVAT = outputVAT - totalVATDeduction; // å®é™…åº”ç¼´ç¨é¢

                // è®¡ç®—æ€»æˆæœ¬ï¼ˆè€ƒè™‘é€€è´§åˆ†æ‘Šï¼‰
                const totalCost = effectiveCost + platformFee + adCostEffective + operationalCost + actualVAT;

                // è®¡ç®—åˆ©æ¶¦
                const profit = actualPrice - totalCost;
                const profitRate = (profit / actualPrice * 100).toFixed(2);

                // æ›´æ–°å®æ—¶åˆ©æ¶¦æ˜¾ç¤º
                const actualProfitInput = document.getElementById('actualProfit');
                const profitRateDisplay = document.getElementById('profitRate');
                const profitStatus = document.getElementById('profitStatus');

                // è®¾ç½®åˆ©æ¶¦é‡‘é¢å’Œæ ·å¼
                actualProfitInput.value = `Â¥ ${profit.toFixed(2)}`;
                actualProfitInput.className = profit >= 0 ? 'profit-positive' : 'profit-negative';

                // è®¾ç½®åˆ©æ¶¦ç‡
                profitRateDisplay.textContent = `${profitRate}%`;

                // è®¾ç½®çŠ¶æ€æç¤º
                let statusText = '';
                let statusClass = '';
                if (profit < 0) {
                    statusText = 'äºæŸ';
                    statusClass = 'status-bad';
                } else if (profitRate < 5) {
                    statusText = 'åˆ©æ¶¦ç‡è¿‡ä½';
                    statusClass = 'status-warning';
                } else if (profitRate > 30) {
                    statusText = 'åˆ©æ¶¦ç‡ä¼˜ç§€';
                    statusClass = 'status-good';
                } else {
                    statusText = 'åˆ©æ¶¦ç‡æ­£å¸¸';
                    statusClass = 'status-good';
                }
                profitStatus.textContent = statusText;
                profitStatus.className = statusClass;

                // ç”Ÿæˆç»“æœHTML
                const resultHtml = `
                    <div class="final-price">
                        <div class="price-label">å®é™…åˆ©æ¶¦</div>
                        <div class="price-value">Â¥ ${profit.toFixed(2)}</div>
                        <div class="price-hint">åˆ©æ¶¦ç‡ï¼š${profitRate}%</div>
                    </div>

                    <div class="section calculation-process">
                        <h3>åˆ©æ¶¦æ„æˆåˆ†æ</h3>
                        <div class="profit-composition">
                            <div class="composition-item revenue">
                                <div class="item-label">é”€å”®æ”¶å…¥</div>
                                <div class="item-value">Â¥ ${actualPrice.toFixed(2)}</div>
                                <div class="item-percent">100%</div>
                            </div>
                            <div class="composition-item cost">
                                <div class="item-label">åŸºç¡€æˆæœ¬</div>
                                <div class="item-value">Â¥ ${effectiveCost.toFixed(2)}</div>
                                <div class="item-percent">${(effectiveCost/actualPrice*100).toFixed(1)}%</div>
                                <div class="cost-detail" style="text-align: left;">
                                    <div class="cost-item">
                                        è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰ï¼šÂ¥ ${costPrice.toFixed(2)}
                                    </div>
                                    <div style="margin: 0.5rem 0; padding: 0.5rem 0; border-top: 1px dashed #e0e0e0; border-bottom: 1px dashed #e0e0e0;">
                                        <div class="cost-item">
                                            å¼€ç¥¨æˆæœ¬ï¼ˆ${(inputTaxRate*100).toFixed(1)}%ï¼‰ï¼šÂ¥ ${(costPrice * inputTaxRate).toFixed(2)}
                                        </div>
                                        <div class="cost-item" style="color: #2ea44f; margin-top: 0.5rem;">
                                            å¯æŠµæ‰£å•†å“ç¨ï¼ˆ${(outputTaxRate*100).toFixed(0)}%ï¼‰ï¼šÂ¥ ${purchaseVAT.toFixed(2)}
                                        </div>
                                    </div>
                                    <div class="cost-item" style="font-weight: 500;">
                                        ç¨åå®é™…æˆæœ¬ï¼šÂ¥ ${effectiveCost.toFixed(2)}
                                    </div>
                                    <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px dashed #e0e0e0;">
                                        è®¡ç®—è¿‡ç¨‹ï¼šè¿›è´§ä»· + å¼€ç¥¨æˆæœ¬ - å¯æŠµæ‰£å•†å“ç¨
                                    </div>
                                </div>
                            </div>
                            <div class="composition-item expenses">
                                <div class="item-label">é”€å”®è´¹ç”¨</div>
                                <div class="item-value">Â¥ ${(platformFee + operationalCost + adCostEffective).toFixed(2)}</div>
                                <div class="item-percent">${((platformFee + operationalCost + adCostEffective)/actualPrice*100).toFixed(1)}%</div>
                                <div class="cost-detail" style="text-align: left;">
                                    <div class="cost-item">å¹³å°ä½£é‡‘ï¼ˆå¯é€€å›ï¼‰ï¼šÂ¥ ${platformFee.toFixed(2)}</div>
                                    <div class="cost-item">å¹¿å‘Šè´¹ç”¨ï¼ˆåˆ†æ‘Šåï¼‰ï¼šÂ¥ ${adCostEffective.toFixed(2)}</div>
                                    <div class="cost-item">ç‰©æµåŠå…¶ä»–ï¼ˆåˆ†æ‘Šåï¼‰ï¼šÂ¥ ${operationalCost.toFixed(2)}</div>
                                    <div class="cost-item" style="color: #666; font-size: 0.85rem;">
                                        æ³¨ï¼šä¸å¯é€€å›è´¹ç”¨å·²æŒ‰é€€è´§ç‡${(returnRate*100).toFixed(0)}%åˆ†æ‘Š
                                    </div>
                                </div>
                            </div>
                            <div class="composition-item tax" style="background: #f0f7ff;">
                                <div class="item-label">ç¨è´¹åˆ†æ</div>
                                <div class="item-value">Â¥ ${actualVAT.toFixed(2)}</div>
                                <div class="item-percent">${(actualVAT/actualPrice*100).toFixed(1)}%</div>
                                <div class="cost-detail" style="text-align: left;">
                                    <div class="cost-item" style="color: #e65100;">
                                        åº”ç¼´é”€é¡¹ç¨ï¼šÂ¥ ${outputVAT.toFixed(2)} (${(outputVAT/actualPrice*100).toFixed(1)}%)
                                    </div>
                                    <div style="margin: 0.5rem 0; padding: 0.5rem 0; border-top: 1px dashed #e0e0e0; border-bottom: 1px dashed #e0e0e0;">
                                        <div class="cost-item" style="color: #2ea44f;">
                                            å¯æŠµæ‰£è¿›é¡¹ç¨ï¼šÂ¥ ${totalVATDeduction.toFixed(2)} (${(totalVATDeduction/actualPrice*100).toFixed(1)}%)
                                        </div>
                                        <div style="margin-top: 0.5rem; padding-left: 1rem; font-size: 0.85rem; color: #666;">
                                            <div class="cost-item">â€¢ å•†å“è¿›é¡¹ç¨ï¼šÂ¥${purchaseVAT.toFixed(2)}</div>
                                            <div class="cost-item">â€¢ å¹¿å‘Šè´¹è¿›é¡¹ç¨ï¼šÂ¥${adVAT.toFixed(2)}</div>
                                            <div class="cost-item">â€¢ å¹³å°ä½£é‡‘è¿›é¡¹ç¨ï¼šÂ¥${(platformFee * 0.06).toFixed(2)}</div>
                                        </div>
                                    </div>
                                    <div class="cost-item" style="font-weight: 500;">
                                        å®é™…åº”ç¼´ç¨è´¹ï¼šÂ¥ ${actualVAT.toFixed(2)} (${(actualVAT/actualPrice*100).toFixed(1)}%)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="calculation-steps">
                            <div class="step-header">è¯¦ç»†æˆæœ¬åˆ†æï¼š</div>
                            
                            <div class="step-section">
                                <div class="step-title">1. è¿›è´§æˆæœ¬åˆ†æ</div>
                                <div class="cost-table">
                                    <table>
                                        <tr>
                                            <td>è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰</td>
                                            <td class="amount">${costPrice.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>å¼€ç¥¨è´¹ç”¨ï¼ˆ${(inputTaxRate*100).toFixed(1)}%ï¼‰</td>
                                            <td class="amount">${invoiceCost.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>è¿›é¡¹ç¨é¢ï¼ˆ${(outputTaxRate*100).toFixed(1)}%ï¼‰</td>
                                            <td class="amount">${purchaseVAT.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr class="total">
                                            <td>ç¨åå®é™…æˆæœ¬</td>
                                            <td class="amount">${effectiveCost.toFixed(2)}å…ƒ</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">2. é”€å”®è´¹ç”¨åˆ†æ</div>
                                <div class="cost-table">
                                    <table>
                                        <tr>
                                            <td>å¹³å°ä½£é‡‘ï¼ˆ${(platformRate*100).toFixed(1)}%ï¼Œå¯é€€å›ï¼‰</td>
                                            <td class="amount">${platformFee.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>å¹¿å‘Šè´¹ç”¨ï¼ˆ${(adRate*100).toFixed(1)}%ï¼‰</td>
                                            <td class="formula">${adCost.toFixed(2)} Ã· ${(effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${adCostEffective.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>ç‰©æµè´¹ç”¨</td>
                                            <td class="formula">${shippingCost.toFixed(2)} Ã· ${(effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${(shippingCost/effectiveRate).toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>è¿è´¹é™©</td>
                                            <td class="formula">${shippingInsurance.toFixed(2)} Ã· ${(effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${(shippingInsurance/effectiveRate).toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>å…¶ä»–æˆæœ¬</td>
                                            <td class="formula">${otherCost.toFixed(2)} Ã· ${(effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${(otherCost/effectiveRate).toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr class="total">
                                            <td colspan="2">é”€å”®è´¹ç”¨åˆè®¡ï¼ˆè€ƒè™‘é€€è´§åˆ†æ‘Šï¼‰</td>
                                            <td class="amount">${(platformFee + operationalCost + adCostEffective).toFixed(2)}å…ƒ</td>
                                        </tr>
                                    </table>
                                    <div style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                                        æ³¨ï¼šç”±äºé€€è´§ç‡${(returnRate*100).toFixed(0)}%ï¼Œä¸å¯é€€å›è´¹ç”¨ï¼ˆå¹¿å‘Šè´¹ã€ç‰©æµè´¹ç­‰ï¼‰éœ€è¦ç”±${(effectiveRate*100).toFixed(0)}%çš„æˆåŠŸè®¢å•åˆ†æ‘Šæ‰¿æ‹…ã€‚
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">3. ç¨è´¹åˆ†æ</div>
                                <div class="cost-table">
                                    <div class="table-section">
                                        <div class="section-title" style="color: #e65100;">é”€é¡¹ç¨è®¡ç®—ï¼š</div>
                                        <div class="section-note">
                                            é”€é¡¹ç¨æ˜¯åŸºäºä¸å«ç¨å”®ä»·è®¡ç®—çš„ï¼Œè®¡ç®—æ­¥éª¤å¦‚ä¸‹ï¼š
                                        </div>
                                        <table>
                                            <tr>
                                                <td>å«ç¨å”®ä»·</td>
                                                <td class="formula">${actualPrice.toFixed(2)}</td>
                                                <td class="amount">${actualPrice.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>ä¸å«ç¨å”®ä»·</td>
                                                <td class="formula">${actualPrice.toFixed(2)} Ã· (1 + ${(outputTaxRate*100).toFixed(0)}%)</td>
                                                <td class="amount">${(actualPrice/(1+outputTaxRate)).toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>é”€é¡¹ç¨é¢ï¼ˆ${(outputTaxRate*100).toFixed(0)}%ï¼‰</td>
                                                <td class="formula">${(actualPrice/(1+outputTaxRate)).toFixed(2)} Ã— ${(outputTaxRate*100).toFixed(0)}%</td>
                                                <td class="amount">${outputVAT.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å å«ç¨å”®ä»·æ¯”ä¾‹</td>
                                                <td class="formula">${outputVAT.toFixed(2)} Ã· ${actualPrice.toFixed(2)} Ã— 100%</td>
                                                <td class="amount">${(outputVAT/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="table-section">
                                        <div class="section-title" style="color: #2ea44f;">è¿›é¡¹ç¨æŠµæ‰£ï¼š</div>
                                        <div class="section-note">
                                            è¿›é¡¹ç¨åŒ…æ‹¬å•†å“ã€å¹¿å‘Šè´¹å’Œå¹³å°ä½£é‡‘çš„å¯æŠµæ‰£ç¨é¢ï¼š
                                        </div>
                                        <table>
                                            <tr>
                                                <td>å•†å“è¿›é¡¹ç¨ï¼ˆ${(outputTaxRate*100).toFixed(0)}%ï¼‰</td>
                                                <td class="formula">${costPrice.toFixed(2)} Ã— ${(outputTaxRate*100).toFixed(0)}%</td>
                                                <td class="amount">${purchaseVAT.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å¹¿å‘Šè´¹è¿›é¡¹ç¨ï¼ˆ6%ï¼‰</td>
                                                <td class="formula">${adCostEffective.toFixed(2)} Ã— 6%</td>
                                                <td class="amount">${adVAT.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å¹³å°ä½£é‡‘è¿›é¡¹ç¨ï¼ˆ6%ï¼‰</td>
                                                <td class="formula">${platformFee.toFixed(2)} Ã— 6%</td>
                                                <td class="amount">${(platformFee * 0.06).toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr class="total">
                                                <td>å¯æŠµæ‰£è¿›é¡¹ç¨åˆè®¡</td>
                                                <td class="formula"></td>
                                                <td class="amount">${totalVATDeduction.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å å«ç¨å”®ä»·æ¯”ä¾‹</td>
                                                <td class="formula">${totalVATDeduction.toFixed(2)} Ã· ${actualPrice.toFixed(2)} Ã— 100%</td>
                                                <td class="amount">${(totalVATDeduction/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="table-section">
                                        <div class="section-title">å®é™…ç¨è´Ÿï¼š</div>
                                        <table>
                                            <tr>
                                                <td>é”€é¡¹ç¨</td>
                                                <td class="amount" style="color: #e65100;">+${outputVAT.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å¯æŠµæ‰£è¿›é¡¹ç¨</td>
                                                <td class="amount" style="color: #2ea44f;">-${totalVATDeduction.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr class="total">
                                                <td>å®é™…åº”ç¼´ç¨é¢</td>
                                                <td class="amount">${actualVAT.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>å å«ç¨å”®ä»·æ¯”ä¾‹</td>
                                                <td class="amount">${(actualVAT/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="step-section">
                                <div class="step-title">4. æœ€ç»ˆåˆ©æ¶¦åˆ†æ</div>
                                <div class="cost-table">
                                    <div class="table-section">
                                        <div class="section-title">æ”¶å…¥åˆ†æï¼š</div>
                                        <table>
                                            <tr>
                                                <td>å«ç¨é”€å”®æ”¶å…¥</td>
                                                <td class="amount">${actualPrice.toFixed(2)}å…ƒ</td>
                                            </tr>
                                            <tr>
                                                <td>ä¸å«ç¨é”€å”®æ”¶å…¥</td>
                                                <td class="formula">${actualPrice.toFixed(2)} Ã· (1 + ${(outputTaxRate*100).toFixed(0)}%)</td>
                                                <td class="amount">${(actualPrice/(1+outputTaxRate)).toFixed(2)}å…ƒ</td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="table-section">
                                        <div class="section-title">æˆæœ¬æ„æˆï¼š</div>
                                        <table>
                                            <tr>
                                                <td colspan="2">1. åŸºç¡€æˆæœ¬</td>
                                                <td class="amount">${effectiveCost.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(effectiveCost/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">2. é”€å”®è´¹ç”¨ï¼š</td>
                                                <td class="amount">${(platformFee + operationalCost + adCostEffective).toFixed(2)}å…ƒ</td>
                                                <td class="percent">${((platformFee + operationalCost + adCostEffective)/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <td width="20px"></td>
                                                <td>â€¢ å¹³å°ä½£é‡‘ï¼ˆå¯é€€å›ï¼‰</td>
                                                <td class="amount">${platformFee.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(platformFee/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td>â€¢ å¹¿å‘Šè´¹ç”¨ï¼ˆåˆ†æ‘Šåï¼‰</td>
                                                <td class="amount">${adCostEffective.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(adCostEffective/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td>â€¢ ç‰©æµåŠå…¶ä»–ï¼ˆåˆ†æ‘Šåï¼‰</td>
                                                <td class="amount">${operationalCost.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(operationalCost/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">3. ç¨è´¹æ”¯å‡ºï¼ˆå‡€é¢ï¼‰</td>
                                                <td class="amount">${actualVAT.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(actualVAT/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr class="total">
                                                <td colspan="2">æ€»æˆæœ¬</td>
                                                <td class="amount">${totalCost.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(totalCost/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                        </table>
                                    </div>

                                    <div class="table-section">
                                        <div class="section-title" style="color: #2ea44f;">æœ€ç»ˆåˆ©æ¶¦ï¼š</div>
                                        <table>
                                            <tr>
                                                <td>é”€å”®æ”¶å…¥</td>
                                                <td class="amount">+${actualPrice.toFixed(2)}å…ƒ</td>
                                                <td class="percent">100%</td>
                                            </tr>
                                            <tr>
                                                <td>æ€»æˆæœ¬</td>
                                                <td class="amount" style="color: #e65100;">-${totalCost.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${(totalCost/actualPrice*100).toFixed(1)}%</td>
                                            </tr>
                                            <tr class="total">
                                                <td>å®é™…åˆ©æ¶¦</td>
                                                <td class="amount" style="color: #2ea44f;">${profit.toFixed(2)}å…ƒ</td>
                                                <td class="percent">${profitRate}%</td>
                                            </tr>
                                        </table>
                                        <div style="margin-top: 0.5rem; font-size: 0.85rem; color: #666;">
                                            æ³¨ï¼šæ‰€æœ‰ç™¾åˆ†æ¯”å‡åŸºäºå«ç¨é”€å”®æ”¶å…¥è®¡ç®—ã€‚ä¸å¯é€€å›è´¹ç”¨å·²æŒ‰é€€è´§ç‡${(returnRate*100).toFixed(0)}%åˆ†æ‘Šã€‚
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('result').innerHTML = resultHtml;
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div class="error">${error.message}</div>
                `;
            }
        }

        // ä¿å­˜æ‰€æœ‰è¾“å…¥å€¼åˆ°localStorage
        function saveInputs() {
            const inputs = {
                // å”®ä»·è®¡ç®—tabçš„è¾“å…¥
                costPrice: document.getElementById("costPrice").value,
                inputTaxRate: document.getElementById("inputTaxRate").value,
                outputTaxRate: document.getElementById("outputTaxRate").value,
                salesTaxRate: document.getElementById("salesTaxRate").value,  // é”€å”®æˆæœ¬ä¸­çš„é”€é¡¹ç¨ç‡
                platformRate: document.getElementById("platformRate").value,
                adRate: document.getElementById("adRate").value,
                shippingInsurance: document.getElementById("shippingInsurance").value,
                shippingCost: document.getElementById("shippingCost").value,
                otherCost: document.getElementById("otherCost").value,
                targetProfitRate: document.getElementById("targetProfitRate").value,
                
                // åˆ©æ¶¦è®¡ç®—tabçš„è¾“å…¥
                profitCostPrice: document.getElementById("profitCostPrice").value,
                actualPrice: document.getElementById("actualPrice").value,
                profitInputTaxRate: document.getElementById("profitInputTaxRate").value,
                profitOutputTaxRate: document.getElementById("profitOutputTaxRate").value,
                profitSalesTaxRate: document.getElementById("profitSalesTaxRate").value,
                profitPlatformRate: document.getElementById("profitPlatformRate").value,
                profitShippingCost: document.getElementById("profitShippingCost").value,
                profitShippingInsurance: document.getElementById("profitShippingInsurance").value,
                profitAdRate: document.getElementById("profitAdRate").value,
                profitOtherCost: document.getElementById("profitOtherCost").value,
                profitReturnRate: document.getElementById("profitReturnRate").value
            };
            localStorage.setItem('priceCalculatorInputs', JSON.stringify(inputs));
            
            // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = 'å·²ä¿å­˜è¾“å…¥å€¼';
            document.body.appendChild(toast);
            
            // 2ç§’åç§»é™¤æç¤º
            setTimeout(() => {
                toast.classList.add('toast-hide');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }

        // ä»localStorageåŠ è½½ä¿å­˜çš„è¾“å…¥å€¼
        function loadSavedInputs() {
            const saved = localStorage.getItem('priceCalculatorInputs');
            if (saved) {
                const inputs = JSON.parse(saved);
                Object.entries(inputs).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.value = value;
                    }
                });
            }
        }

        // éªŒè¯è¾“å…¥å€¼çš„åˆæ³•æ€§
        function validateInput(value, min, max, name) {
            if (isNaN(value) || value < min || value > max) {
                throw new Error(`${name}å¿…é¡»åœ¨${min}åˆ°${max}ä¹‹é—´`);
            }
            return value;
        }

        // è·å–å¹¶éªŒè¯æ‰€æœ‰è¾“å…¥å€¼
        function getValidatedInputs() {
            return {
                costPrice: validateInput(parseFloat(document.getElementById("costPrice").value), 0.01, 1000000, "è¿›è´§ä»·"),
                inputTaxRate: validateInput(parseFloat(document.getElementById("inputTaxRate").value), 0, 100, "è¿›é¡¹ç¨ç‡") / 100,
                outputTaxRate: validateInput(parseFloat(document.getElementById("outputTaxRate").value), 0, 100, "å•†å“ç¨ç‡") / 100,
                salesTaxRate: validateInput(parseFloat(document.getElementById("salesTaxRate").value), 0, 100, "é”€é¡¹ç¨ç‡") / 100,
                platformRate: validateInput(parseFloat(document.getElementById("platformRate").value), 0, 100, "å¹³å°æŠ½ä½£æ¯”ä¾‹") / 100,
                shippingCost: validateInput(parseFloat(document.getElementById("shippingCost").value), 0, 10000, "ç‰©æµè´¹"),
                otherCost: validateInput(parseFloat(document.getElementById("otherCost").value), 0, 10000, "å…¶ä»–æˆæœ¬"),
                adRate: validateInput(parseFloat(document.getElementById("adRate").value), 0, 100, "ä»˜è´¹å æ¯”") / 100,
                shippingInsurance: validateInput(parseFloat(document.getElementById("shippingInsurance").value), 0, 100, "è¿è´¹é™©"),
                returnRate: validateInput(parseFloat(document.getElementById("returnRate").value), 0, 100, "é€€è´§ç‡") / 100,
                targetProfitRate: validateInput(parseFloat(document.getElementById("targetProfitRate").value), 0, 100, "ç›®æ ‡åˆ©æ¶¦ç‡") / 100
            };
        }

        // è®¡ç®—è¿›è´§æˆæœ¬å’Œå¯æŠµæ‰£ç¨é¢
        function calculatePurchaseCost(inputs) {
            // 1. åŸºç¡€è¿›è´§æˆæœ¬è®¡ç®—
            const purchasePrice = inputs.costPrice; // è¿›è´§ä»·ï¼ˆä¸å«ç¨ï¼‰
            const invoiceCost = purchasePrice * inputs.inputTaxRate; // å¼€ç¥¨æˆæœ¬ï¼ˆå¦‚6%ï¼‰
            
            // 2. è¿›é¡¹ç¨é¢è®¡ç®—ï¼ˆå¯æŠµæ‰£ï¼Œæœªæ¥å¯ç”¨äºæŠµå‡é”€é¡¹ç¨ï¼‰
            const purchaseVAT = purchasePrice * inputs.outputTaxRate; // å•†å“è¿›é¡¹ç¨é¢ï¼ˆå¦‚13%ï¼‰
            
            // 3. æ€»è¿›è´§æˆæœ¬ï¼ˆå®é™…éœ€è¦æ”¯ä»˜çš„é‡‘é¢ï¼‰
            const totalPurchaseCost = purchasePrice + invoiceCost; // æ€»è¿›è´§æˆæœ¬
            
            // 4. ç¨åå®é™…æˆæœ¬ï¼ˆè€ƒè™‘æœªæ¥è¿›é¡¹ç¨æŠµæ‰£åçš„å®é™…æˆæœ¬ï¼‰
            const effectiveCost = totalPurchaseCost - purchaseVAT; // è€ƒè™‘è¿›é¡¹ç¨æŠµæ‰£åçš„å®é™…æˆæœ¬

            return {
                purchasePrice,      // ä¸å«ç¨è¿›è´§ä»·
                invoiceCost,        // å¼€ç¥¨è´¹ç”¨
                totalPurchaseCost,  // å®é™…æ”¯ä»˜æ€»é‡‘é¢
                purchaseVAT,        // å¯æŠµæ‰£è¿›é¡¹ç¨ï¼ˆæœªæ¥ç¨æ”¶æ”¶ç›Šï¼‰
                effectiveCost       // è€ƒè™‘ç¨æ”¶æŠµæ‰£åçš„å®é™…æˆæœ¬
            };
        }

        // è®¡ç®—é”€å”®æˆæœ¬å’Œç¨è´¹
        function calculateSalesCost(inputs, adCost, purchaseCost) {
            // 1. è®¡ç®—é€€è´§å½±å“
            const returnRate = inputs.returnRate;
            const effectiveRate = 1 - returnRate;

            // 2. è®¡ç®—é”€å”®ç›¸å…³æˆæœ¬ï¼ˆè€ƒè™‘é€€è´§åˆ†æ‘Šï¼‰
            const operationalCosts = {
                shipping: inputs.shippingCost / effectiveRate,
                insurance: inputs.shippingInsurance / effectiveRate,
                advertising: adCost / effectiveRate,
                other: inputs.otherCost / effectiveRate
            };

            // 3. å¹¿å‘Šè´¹å’Œå¹³å°ä½£é‡‘çš„è¿›é¡¹ç¨é¢ï¼ˆå¯æŠµæ‰£ï¼‰
            const VAT_RATE = 0.06; // ç°ä»£æœåŠ¡ä¸šå¢å€¼ç¨ç‡6%
            const adVAT = (adCost / effectiveRate) * VAT_RATE;
            const platformVAT = inputs.platformRate * VAT_RATE; // å¹³å°ä½£é‡‘çš„å¯æŠµæ‰£è¿›é¡¹ç¨ç‡

            // 4. æ€»é”€å”®æˆæœ¬ï¼ˆä¸å«å¹³å°ä½£é‡‘ï¼Œå› ä¸ºä½£é‡‘åŸºäºæœ€ç»ˆå”®ä»·ï¼‰
            const totalOperationalCost = Object.values(operationalCosts).reduce((a, b) => a + b, 0);

            // 5. æ€»å¯æŠµæ‰£è¿›é¡¹ç¨
            const totalVATDeduction = purchaseCost.purchaseVAT + adVAT + platformVAT;

            return {
                operationalCosts,
                adVAT,
                totalOperationalCost,
                totalVATDeduction,
                returnRate,
                effectiveRate
            };
        }

        // è®¡ç®—æœ€ç»ˆä»·æ ¼å’Œç›¸å…³è´¹ç”¨
        function calculatePrices(purchaseCost, salesCost, inputs) {
            // 1. è®¡ç®—å›ºå®šæˆæœ¬ï¼ˆè€ƒè™‘é€€è´§ç‡ï¼‰
            // æŒ‰æ–°è§„åˆ™ï¼šä»…å¯¹"ä¸å¯é€€å›"çš„å›ºå®šæˆæœ¬ï¼ˆç‰©æµã€è¿è´¹é™©ã€å…¶ä»–ï¼‰æŒ‰æœ‰æ•ˆé”€å”®ç‡åˆ†æ‘Š
            // è¿›è´§æˆæœ¬Cä¸éšé€€è´§ç‡åˆ†æ‘Šï¼ŒåŸå› ï¼šé€€è´§åå•†å“å¯å›æ”¶å†å”®ï¼Œæˆæœ¬ä¸è¢«æŸè€—
            const fixedCosts = (inputs.shippingCost + inputs.shippingInsurance + inputs.otherCost) / salesCost.effectiveRate;
            
            // 2. åˆ©æ¶¦ç‡æŒ‰å®šä¹‰ï¼š(æœ€ç»ˆå”®ä»·-æ‰€æœ‰æˆæœ¬å’Œç¨è´¹)/æœ€ç»ˆå”®ä»· = ç›®æ ‡åˆ©æ¶¦ç‡
            // å°†åŸºäºæœ€ç»ˆä»·è®¡æçš„é”€é¡¹ç¨ç­‰æ¯”ä¾‹é¡¹æ¢ç®—ä¸º"æœ€ç»ˆä»·çš„å æ¯”"
            const VAT_RATE = 0.06; // ç°ä»£æœåŠ¡ä¸šå¢å€¼ç¨ç‡6%
            const taxFactorOnFinal = inputs.salesTaxRate / (1 + inputs.salesTaxRate); // é”€é¡¹ç¨å æœ€ç»ˆå”®ä»·æ¯”ä¾‹
            const adFactorEffective = inputs.adRate / salesCost.effectiveRate;       // å¹¿å‘Šè´¹åˆ†æ‘Šï¼ˆä¸å¯é€€å›ï¼‰
            const adVatCreditFactor = VAT_RATE * adFactorEffective;                  // å¹¿å‘Šè´¹è¿›é¡¹ç¨æŠµæ‰£å æ¯”
            const platformVatCreditFactor = VAT_RATE * inputs.platformRate;          // å¹³å°ä½£é‡‘è¿›é¡¹ç¨æŠµæ‰£å æ¯”
            const profitFactorEffective = inputs.targetProfitRate;                   // ç›®æ ‡åˆ©æ¶¦ç‡æŒ‰æœ€ç»ˆå”®ä»·å£å¾„ï¼Œä¸éšé€€è´§åˆ†æ‘Š
            
            // åˆ†å­ï¼šCï¼ˆå·²æ‰£è¿›é¡¹ç¨ï¼‰+ F_ä¸å¯é€€å›/(1-R)
            const numeratorFinal = purchaseCost.effectiveCost + fixedCosts;
            // åˆ†æ¯ï¼š1 - å¹³å°è´¹ - ç¨å æ¯” - ç›®æ ‡åˆ©æ¶¦ç‡ - å¹¿å‘Šè´¹åˆ†æ‘Šå æ¯” + å¹¿å‘Šè´¹å¯æŠµæ‰£è¿›é¡¹ç¨å æ¯” + å¹³å°ä½£é‡‘è¿›é¡¹ç¨æŠµæ‰£å æ¯”
            const denominatorFinal = 1 - inputs.platformRate - taxFactorOnFinal - inputs.targetProfitRate - adFactorEffective + adVatCreditFactor + platformVatCreditFactor;
            
            // 3. è®¡ç®—å«ç¨å”®ä»·ã€åŠä¸å«ç¨å‡€ä»·
            const finalPrice = numeratorFinal / denominatorFinal;
            const netPrice = finalPrice / (1 + inputs.salesTaxRate);
            
            // 4. è®¡ç®—å„é¡¹è´¹ç”¨
            const platformFee = finalPrice * inputs.platformRate;
            const adCost = finalPrice * inputs.adRate;
            const outputVAT = netPrice * inputs.salesTaxRate;
            const profit = finalPrice * inputs.targetProfitRate;
            
            // 5. è®¡ç®—å¹¿å‘Šè´¹è¿›é¡¹ç¨ï¼ˆå¹¿å‘Šè´¹ä¸ºå¯æŠµæ‰£6%ï¼Œä¸”ä¸ºä¸å¯é€€å›æˆæœ¬ï¼Œéœ€æŒ‰(1-R)åˆ†æ‘Šï¼‰
            const adVAT = (adCost / salesCost.effectiveRate) * VAT_RATE;
            
            // 6. è®¡ç®—å®é™…ç¨è´Ÿï¼ˆé”€é¡¹ç¨ - è¿›é¡¹ç¨(å•†å“+å¹¿å‘Š)ï¼‰
            const totalVATDeduction = purchaseCost.purchaseVAT + adVAT;
            const actualVAT = outputVAT - totalVATDeduction;

            // 7. è®¡ç®—â€œæœ‰æ•ˆæˆæœ¬â€ç”¨äºç»“æœå±•ç¤ºï¼ˆä¸å‚ä¸è”ç«‹ï¼Œä¾¿äºç†è§£å£å¾„ï¼‰
            // æœ‰æ•ˆæˆæœ¬ = Cï¼ˆç¨åè¿›è´§æˆæœ¬ï¼‰ + F_ä¸å¯é€€å›/(1-R)
            // å…¶ä¸­ F_ä¸å¯é€€å› = å¹¿å‘Šè´¹ + å‘è´§ç‰©æµè´¹ + è¿è´¹é™© + å…¶ä»–å›ºå®šæˆæœ¬
            const effectiveNonReturnableCost = (inputs.shippingCost + inputs.shippingInsurance + inputs.otherCost) / salesCost.effectiveRate + (adCost / salesCost.effectiveRate);
            const effectiveCostTotal = purchaseCost.effectiveCost + effectiveNonReturnableCost;

            return {
                netPrice,
                finalPrice,
                platformFee,
                outputVAT,
                actualVAT,
                profit,
                profitRate: inputs.targetProfitRate * 100,
                adCost,
                fixedCosts,
                adVAT,
                totalVATDeduction,
                effectiveNonReturnableCost,
                effectiveCostTotal,
                taxFactorOnFinal,
                adFactorEffective,
                adVatCreditFactor,
                profitFactorEffective,
                platformVatCreditFactor
            };
        }

        // ç”Ÿæˆç»“æœHTML
        function generateResultHtml(purchaseCost, salesCost, priceInfo, inputs) {
            const adCost = priceInfo.adCost;
            
            return `
                <div class="final-price">
                    <div class="price-label">å»ºè®®å«ç¨å”®ä»·</div>
                    <div class="price-value">Â¥ ${priceInfo.finalPrice.toFixed(2)}</div>
                    <div class="price-hint">æ­¤ä»·æ ¼å·²è€ƒè™‘æ‰€æœ‰æˆæœ¬ã€ç¨è´¹å’Œç›®æ ‡åˆ©æ¶¦</div>
                </div>

                <div class="section calculation-process">
                    <h3>ä»·æ ¼æ„æˆåˆ†æ</h3>
                    <div class="price-composition">
                        <div class="composition-item">
                            <div class="item-label">åŸºç¡€æˆæœ¬</div>
                            <div class="item-value">Â¥ ${purchaseCost.effectiveCost.toFixed(2)}</div>
                            <div class="item-percent">${(purchaseCost.effectiveCost/priceInfo.finalPrice*100).toFixed(1)}%</div>
                        </div>
                        <div class="composition-item">
                            <div class="item-label">é”€å”®è´¹ç”¨</div>
                            <div class="item-value">Â¥ ${(priceInfo.platformFee + salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance + (priceInfo.adCost / salesCost.effectiveRate)).toFixed(2)}</div>
                            <div class="item-percent">${((priceInfo.platformFee + salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance + (priceInfo.adCost / salesCost.effectiveRate))/priceInfo.finalPrice*100).toFixed(1)}%</div>
                            <div class="cost-detail">
                                <div class="cost-item">å¹³å°ä½£é‡‘ï¼šÂ¥ ${priceInfo.platformFee.toFixed(2)}</div>
                                <div class="cost-item">å¹¿å‘Šè´¹ç”¨ï¼šÂ¥ ${(priceInfo.adCost / salesCost.effectiveRate).toFixed(2)}</div>
                                <div class="cost-item">ç‰©æµåŠå…¶ä»–ï¼šÂ¥ ${(salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance).toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="composition-item">
                            <div class="item-label">ç¨è´¹æ”¯å‡ºï¼ˆå‡€é¢ï¼‰</div>
                            <div class="item-value">Â¥ ${priceInfo.actualVAT.toFixed(2)}</div>
                            <div class="item-percent">${(priceInfo.actualVAT/priceInfo.finalPrice*100).toFixed(1)}%</div>
                            <div class="tax-detail">
                                <div class="tax-item">é”€é¡¹ç¨ï¼šÂ¥ ${priceInfo.outputVAT.toFixed(2)}</div>
                                <div class="tax-item">å¯æŠµæ‰£ï¼šÂ¥ ${priceInfo.totalVATDeduction.toFixed(2)}</div>
                                <div class="tax-item">å®ç¼´ç¨è´¹ï¼šÂ¥ ${priceInfo.actualVAT.toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="composition-item profit">
                            <div class="item-label">é¢„æœŸåˆ©æ¶¦</div>
                            <div class="item-value">Â¥ ${priceInfo.profit.toFixed(2)}</div>
                            <div class="item-percent">${(priceInfo.profit/priceInfo.finalPrice*100).toFixed(1)}%</div>
                        </div>
                    </div>
                    <div class="price-note">æ³¨æ„ï¼šç”±äºå¹³å°ä½£é‡‘ï¼ˆ${(inputs.platformRate*100).toFixed(1)}%ï¼‰å’Œå¹¿å‘Šè´¹ï¼ˆ${(inputs.adRate*100).toFixed(1)}%ï¼‰æ˜¯åŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—çš„ï¼Œæ‰€ä»¥å„é¡¹é‡‘é¢ç›´æ¥ç›¸åŠ ä¸ç­‰äºæœ€ç»ˆå”®ä»·ã€‚</div>
                    
                    <div class="calculation-steps">
                        <div class="step-header">è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼ˆæ‰€æœ‰æˆæœ¬éƒ½å·²è€ƒè™‘é€€è´§ç‡${(salesCost.returnRate*100).toFixed(0)}%çš„å½±å“ï¼‰ï¼š</div>
                        
                        <div class="step-section">
                            <div class="step-title">1. åŸºç¡€æˆæœ¬è®¡ç®—</div>
                            
                            <div class="cost-table">
                                <div class="table-section">
                                    <div class="section-title">è¿›è´§ç›¸å…³ï¼š</div>
                                    <table>
                                        <tr>
                                            <td>è¿›è´§æˆæœ¬</td>
                                            <td class="amount">${purchaseCost.totalPurchaseCost.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>ç¨åå®é™…æˆæœ¬ï¼ˆCï¼‰<br><span class="note">å·²æ‰£é™¤å¯æŠµæ‰£è¿›é¡¹ç¨ï¼Œä¸éšé€€è´§ç‡åˆ†æ‘Š</span></td>
                                            <td class="amount">${purchaseCost.effectiveCost.toFixed(2)}å…ƒ</td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <div class="table-section">
                                    <div class="section-title">è¿è¥ç›¸å…³ï¼ˆè€ƒè™‘é€€è´§åˆ†æ‘Šï¼‰ï¼š</div>
                                    <div class="section-note">æ³¨ï¼šå¹³å°ä½£é‡‘ï¼ˆ${(inputs.platformRate*100).toFixed(1)}%ï¼‰åŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—ï¼Œå°†åœ¨æœ€ç»ˆå®šä»·æ—¶è®¡å…¥</div>
                                    <table>
                                        <tr>
                                            <td>ç‰©æµè´¹</td>
                                            <td class="formula">${inputs.shippingCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${salesCost.operationalCosts.shipping.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>è¿è´¹é™©</td>
                                            <td class="formula">${inputs.shippingInsurance.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${salesCost.operationalCosts.insurance.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>å¹¿å‘Šè´¹ï¼ˆä¸å¯é€€å›ï¼‰</td>
                                            <td class="formula">${adCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${(adCost / salesCost.effectiveRate).toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr>
                                            <td>å…¶ä»–æˆæœ¬</td>
                                            <td class="formula">${inputs.otherCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}%</td>
                                            <td class="amount">${salesCost.operationalCosts.other.toFixed(2)}å…ƒ</td>
                                        </tr>
                                        <tr class="total">
                                            <td colspan="2">è¿è¥æˆæœ¬åˆè®¡ï¼ˆä¸å«å¹³å°ä½£é‡‘ï¼‰</td>
                                            <td class="amount">${(salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance + (adCost / salesCost.effectiveRate) + salesCost.operationalCosts.other).toFixed(2)}å…ƒ</td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <div class="table-section">
                                    <div class="section-title">åŸºç¡€æˆæœ¬åˆè®¡ï¼š</div>
                                    <div class="total-amount">${(purchaseCost.effectiveCost + salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance + (adCost / salesCost.effectiveRate) + salesCost.operationalCosts.other).toFixed(2)}å…ƒ</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-section">
                            <div class="step-title">2. è®¡ç®—ä¸å«ç¨å”®ä»·</div>
                            <div class="formula-box">
                                <div class="formula-title">è®¡ç®—å…¬å¼ï¼š</div>
                                <div class="formula-content">
                                    (ç¨åè¿›è´§æˆæœ¬ + ä¸å¯é€€å›å›ºå®šæˆæœ¬/(1-é€€è´§ç‡)) Ã· (1 - å¹³å°è´¹ç‡ - é”€é¡¹ç¨ç‡ - ç›®æ ‡åˆ©æ¶¦ç‡ - å¹¿å‘Šè´¹ç‡/(1-é€€è´§ç‡) + å¹¿å‘Šè´¹è¿›é¡¹ç¨æŠµæ‰£ + å¹³å°ä½£é‡‘è¿›é¡¹ç¨æŠµæ‰£)
                                </div>
                                <div class="formula-note">
                                    è¯´æ˜ï¼šæŒ‰åˆ©æ¶¦ç‡å®šä¹‰ (æœ€ç»ˆå”®ä»·-æ‰€æœ‰æˆæœ¬å’Œç¨è´¹)/æœ€ç»ˆå”®ä»· = ç›®æ ‡åˆ©æ¶¦ç‡ è¿›è¡Œè”ç«‹æ±‚è§£
                                </div>
                            </div>
                            
                            <div class="calculation-details">
                                <table>
                                    <tr>
                                        <td>å›ºå®šæˆæœ¬ï¼ˆç‰©æµã€è¿è´¹é™©ã€å…¶ä»–ï¼‰</td>
                                        <td class="amount">${priceInfo.fixedCosts.toFixed(2)}å…ƒ</td>
                                    </tr>
                                    <tr>
                                        <td>
                                            æ¯”ä¾‹è´¹ç”¨ï¼ˆæŒ‰æœ€ç»ˆå”®ä»·å£å¾„ï¼‰ï¼š<br>
                                            <span class="detail-items">
                                                å¹³å°ä½£é‡‘ ${(inputs.platformRate*100).toFixed(1)}% +<br>
                                                é”€é¡¹ç¨å æ¯” ${(priceInfo.taxFactorOnFinal*100).toFixed(1)}% +<br>
                                                ç›®æ ‡åˆ©æ¶¦åˆ†æ‘Š ${(priceInfo.profitFactorEffective*100).toFixed(1)}% +<br>
                                                å¹¿å‘Šè´¹åˆ†æ‘Š ${(priceInfo.adFactorEffective*100).toFixed(1)}% -<br>
                                                å¹¿å‘Šè´¹è¿›é¡¹ç¨æŠµæ‰£ ${(priceInfo.adVatCreditFactor*100).toFixed(1)}% -<br>
                                                å¹³å°ä½£é‡‘è¿›é¡¹ç¨æŠµæ‰£ ${(priceInfo.platformVatCreditFactor*100).toFixed(1)}%
                                            </span>
                                        </td>
                                        <td class="amount">${(100*(inputs.platformRate + priceInfo.taxFactorOnFinal + priceInfo.profitFactorEffective + priceInfo.adFactorEffective - priceInfo.adVatCreditFactor - priceInfo.platformVatCreditFactor)).toFixed(1)}%</td>
                                    </tr>
                                </table>
                                
                                <div class="final-calculation">
                                    <div class="calc-step">
                                        å…·ä½“è®¡ç®—ï¼š(${purchaseCost.effectiveCost.toFixed(2)} + ${priceInfo.fixedCosts.toFixed(2)}) Ã· (1 - ${(100*(inputs.platformRate + priceInfo.taxFactorOnFinal + priceInfo.profitFactorEffective + priceInfo.adFactorEffective - priceInfo.adVatCreditFactor)).toFixed(1)}%)
                                    </div>
                                    <div class="calc-result">
                                        = ${priceInfo.netPrice.toFixed(2)}å…ƒ
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-section">
                            <div class="step-title">3. è®¡ç®—å«ç¨å”®ä»·</div>
                            <div class="final-price-calc">
                                <div class="calc-formula">ä¸å«ç¨å”®ä»· Ã— (1 + å•†å“ç¨ç‡)</div>
                                <div class="calc-step">${priceInfo.netPrice.toFixed(2)} Ã— (1 + ${(inputs.outputTaxRate*100).toFixed(0)}%)</div>
                                <div class="calc-result">= ${priceInfo.finalPrice.toFixed(2)}å…ƒ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <h3>è¿›è´§æˆæœ¬åˆ†æ</h3>
                    <ul>
                        <li>äº§å“æˆæœ¬ï¼ˆä¸å«ç¨ï¼‰ï¼š${purchaseCost.purchasePrice.toFixed(2)} å…ƒ</li>
                        <li>å¼€ç¥¨è´¹ç”¨ï¼ˆ${(inputs.inputTaxRate*100).toFixed(0)}%ï¼‰ï¼š${purchaseCost.invoiceCost.toFixed(2)} å…ƒ</li>
                        <li>å®é™…æ”¯ä»˜æ€»é¢ï¼š${purchaseCost.totalPurchaseCost.toFixed(2)} å…ƒ</li>
                        <li>å¯æŠµæ‰£è¿›é¡¹ç¨ï¼ˆ${(inputs.outputTaxRate*100).toFixed(0)}%ï¼‰ï¼š${purchaseCost.purchaseVAT.toFixed(2)} å…ƒ
                            <ul>
                                <li>è¿™éƒ¨åˆ†ç¨é¢å°†æ¥å¯ä»¥æŠµå‡é”€é¡¹ç¨ï¼Œç›¸å½“äºæœªæ¥çš„ç¨æ”¶æ”¶ç›Š</li>
                                <li>æ³¨æ„ï¼šè¿™ä¸æ˜¯ç«‹å³çš„ç°é‡‘æ”¶ç›Šï¼Œè€Œæ˜¯åœ¨é”€å”®ç¯èŠ‚äº§ç”Ÿé”€é¡¹ç¨æ—¶æ‰èƒ½æŠµæ‰£</li>
                            </ul>
                        </li>
                        <li>ç¨åå®é™…æˆæœ¬ï¼š${purchaseCost.effectiveCost.toFixed(2)} å…ƒ
                            <ul>
                                <li>è¿™æ˜¯è€ƒè™‘äº†è¿›é¡¹ç¨æŠµæ‰£åçš„å®é™…æˆæœ¬å‹åŠ›</li>
                                <li>è®¡ç®—æ–¹å¼ï¼šå®é™…æ”¯ä»˜æ€»é¢ - å¯æŠµæ‰£è¿›é¡¹ç¨</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="section">
                    <h3>é”€å”®æˆæœ¬ï¼ˆè€ƒè™‘é€€è´§ç‡${(salesCost.returnRate*100).toFixed(0)}%ï¼‰</h3>
                    <div class="sales-cost-analysis">
                        <div class="analysis-header">
                            ç”±äºé€€è´§ç‡${(salesCost.returnRate*100).toFixed(0)}%ï¼Œæ„å‘³ç€æ¯100å•ä¸­æœ‰${(salesCost.returnRate*100).toFixed(0)}å•ä¼šé€€è´§ï¼Œä»¥ä¸‹æˆæœ¬ä¼šç”±${(salesCost.effectiveRate*100).toFixed(0)}å•æˆåŠŸé”€å”®çš„è®¢å•åˆ†æ‘Šæ‰¿æ‹…
                        </div>
                        <div class="cost-breakdown">
                            <div class="cost-item">
                                <div class="cost-title">å¹¿å‘Šè´¹ç”¨ï¼š${(adCost / salesCost.effectiveRate).toFixed(2)}å…ƒ</div>
                                <div class="cost-details">
                                    <div class="detail-row">
                                        <span class="detail-label">åŸºç¡€å¹¿å‘Šè´¹ï¼ˆ${(inputs.adRate*100).toFixed(0)}%ï¼‰ï¼š</span>
                                        <span class="detail-value">${adCost.toFixed(2)}å…ƒ</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">åˆ†æ‘Šåæ¯å•å¹¿å‘Šè´¹ï¼š</span>
                                        <span class="detail-formula">${adCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${(adCost / salesCost.effectiveRate).toFixed(2)}å…ƒ</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">å¹¿å‘Šè´¹è¿›é¡¹ç¨ï¼ˆ6%ï¼Œå¯æŠµæ‰£ï¼‰ï¼š</span>
                                        <span class="detail-value">${priceInfo.adVAT.toFixed(2)}å…ƒ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-row">
                                    <span class="cost-label">ç‰©æµè´¹ç”¨ï¼š</span>
                                    <span class="cost-formula">${inputs.shippingCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${salesCost.operationalCosts.shipping.toFixed(2)}å…ƒ</span>
                                </div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-row">
                                    <span class="cost-label">è¿è´¹é™©ï¼š</span>
                                    <span class="cost-formula">${inputs.shippingInsurance.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${salesCost.operationalCosts.insurance.toFixed(2)}å…ƒ</span>
                                </div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-row">
                                    <span class="cost-label">å…¶ä»–æˆæœ¬ï¼š</span>
                                    <span class="cost-formula">${inputs.otherCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${salesCost.operationalCosts.other.toFixed(2)}å…ƒ</span>
                                </div>
                            </div>
                            <div class="total-cost">
                                <span class="total-label">æ€»è¿è¥æˆæœ¬ï¼š</span>
                                <span class="total-value">${(salesCost.operationalCosts.shipping + salesCost.operationalCosts.insurance + (adCost / salesCost.effectiveRate) + salesCost.operationalCosts.other).toFixed(2)}å…ƒ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>ç¨è´¹åˆ†æ</h3>
                    <ul>
                        <li>é”€é¡¹ç¨é¢ï¼ˆåº”æ”¶ï¼‰ï¼š${priceInfo.outputVAT.toFixed(2)} å…ƒ</li>
                        <li>è¿›é¡¹ç¨é¢ï¼ˆå¯æŠµæ‰£ï¼‰ï¼š${(purchaseCost.purchaseVAT + priceInfo.adVAT + priceInfo.platformVatCreditFactor * priceInfo.finalPrice).toFixed(2)} å…ƒ
                            <ul>
                                <li>å•†å“è¿›é¡¹ç¨ï¼š${purchaseCost.purchaseVAT.toFixed(2)} å…ƒ</li>
                                <li>å¹¿å‘Šè´¹è¿›é¡¹ç¨ï¼š${priceInfo.adVAT.toFixed(2)} å…ƒ</li>
                                <li>å¹³å°ä½£é‡‘è¿›é¡¹ç¨ï¼š${(priceInfo.platformVatCreditFactor * priceInfo.finalPrice).toFixed(2)} å…ƒ</li>
                            </ul>
                        </li>
                        <li>å®é™…åº”ç¼´ç¨é¢ï¼š${priceInfo.actualVAT.toFixed(2)} å…ƒ</li>
                    </ul>
                </div>

                <div class="section">
                    <h3>æœ€ç»ˆç»“æœ</h3>
                    <ul>
                        <li>æœ‰æ•ˆæˆæœ¬ï¼š
                            <ul>
                                <li>Cï¼ˆç¨åè¿›è´§æˆæœ¬ï¼‰ï¼š${purchaseCost.effectiveCost.toFixed(2)} å…ƒ</li>
                                <li>F ä¸å¯é€€å›åˆ†æ‘Šï¼š
                                    <ul>
                                        <li>å¹¿å‘Šè´¹ï¼š${priceInfo.adCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${(priceInfo.adCost / salesCost.effectiveRate).toFixed(2)} å…ƒ</li>
                                        <li>å‘è´§ç‰©æµè´¹ï¼š${inputs.shippingCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${(inputs.shippingCost / salesCost.effectiveRate).toFixed(2)} å…ƒ</li>
                                        <li>è¿è´¹é™©ï¼š${inputs.shippingInsurance.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${(inputs.shippingInsurance / salesCost.effectiveRate).toFixed(2)} å…ƒ</li>
                                        <li>å…¶ä»–å›ºå®šæˆæœ¬ï¼š${inputs.otherCost.toFixed(2)} Ã· ${(salesCost.effectiveRate*100).toFixed(0)}% = ${(inputs.otherCost / salesCost.effectiveRate).toFixed(2)} å…ƒ</li>
                                        <li>åˆè®¡ï¼ˆF ä¸å¯é€€å›/(1-R)ï¼‰ï¼š${priceInfo.effectiveNonReturnableCost.toFixed(2)} å…ƒ</li>
                                    </ul>
                                </li>
                                <li>æœ‰æ•ˆæˆæœ¬åˆè®¡ï¼š${priceInfo.effectiveCostTotal.toFixed(2)} å…ƒ</li>
                            </ul>
                        </li>
                        <li>ä¸å«ç¨å”®ä»·ï¼š${priceInfo.netPrice.toFixed(2)} å…ƒ</li>
                        <li>å«ç¨å”®ä»·ï¼š${priceInfo.finalPrice.toFixed(2)} å…ƒ</li>
                        <li>å¹³å°ä½£é‡‘ï¼š
                            <ul>
                                <li>è®¡ç®—åŸºæ•°ï¼šå«ç¨å”®ä»· ${priceInfo.finalPrice.toFixed(2)} å…ƒ</li>
                                <li>è´¹ç‡ï¼š${(inputs.platformRate*100).toFixed(1)}%</li>
                                <li>ä½£é‡‘é‡‘é¢ï¼š${priceInfo.platformFee.toFixed(2)} å…ƒ</li>
                            </ul>
                        </li>
                        <li>é¢„æœŸåˆ©æ¶¦ï¼š${priceInfo.profit.toFixed(2)} å…ƒï¼ˆ${priceInfo.profitRate.toFixed(1)}%ï¼‰</li>
                    </ul>
                </div>

                <p class="calculation-note">è®¡ç®—è¯´æ˜ï¼š</p>
                <ul class="calculation-note">
                    <li>è¿›è´§ç›¸å…³ï¼š
                        <ul>
                            <li>å®é™…æ”¯ä»˜æ€»é¢ = äº§å“æˆæœ¬ï¼ˆä¸å«ç¨ï¼‰ + å¼€ç¥¨è´¹ç”¨</li>
                            <li>å¯æŠµæ‰£è¿›é¡¹ç¨ = äº§å“æˆæœ¬ Ã— å•†å“ç¨ç‡ï¼ˆ${(inputs.outputTaxRate*100).toFixed(0)}%ï¼‰</li>
                            <li>ç¨åå®é™…æˆæœ¬ = å®é™…æ”¯ä»˜æ€»é¢ - å¯æŠµæ‰£è¿›é¡¹ç¨</li>
                            <li>æ³¨æ„ï¼šè¿›é¡¹ç¨æŠµæ‰£æ˜¯æœªæ¥çš„ç¨æ”¶æ”¶ç›Šï¼Œä¸æ˜¯ç«‹å³çš„ç°é‡‘å‡å°‘</li>
                        </ul>
                    </li>
                    <li>å¹¿å‘Šè´¹ç›¸å…³ï¼š
                        <ul>
                            <li>å¹¿å‘Šè´¹ = æœ€ç»ˆå”®ä»· Ã— å¹¿å‘Šè´¹ç‡ï¼ˆ${(inputs.adRate*100).toFixed(0)}%ï¼‰</li>
                            <li>å¹¿å‘Šè´¹è¿›é¡¹ç¨ = å¹¿å‘Šè´¹ Ã— 6%ï¼ˆå¯æŠµæ‰£ï¼‰</li>
                        </ul>
                    </li>
                    <li>ç¨è´¹ç›¸å…³ï¼š
                        <ul>
                            <li>é”€é¡¹ç¨é¢ = å«ç¨å”®ä»· Ã· (1 + ç¨ç‡) Ã— ç¨ç‡</li>
                            <li>å®é™…åº”ç¼´ç¨é¢ = é”€é¡¹ç¨é¢ - å¯æŠµæ‰£è¿›é¡¹ç¨é¢ï¼ˆåŒ…æ‹¬å•†å“å’Œå¹¿å‘Šè´¹ï¼‰</li>
                        </ul>
                    </li>
                    <li>å…¶ä»–è®¡ç®—ï¼š
                        <ul>
                            <li>å¹³å°ä½£é‡‘ = å«ç¨å”®ä»· Ã— å¹³å°è´¹ç‡</li>
                            <li>é¢„æœŸåˆ©æ¶¦ = å«ç¨å”®ä»· Ã— ç›®æ ‡åˆ©æ¶¦ç‡</li>
                        </ul>
                    </li>
                    <li>é€€è´§ç‡å½±å“ï¼š
                        <ul>
                            <li>æœ‰æ•ˆé”€å”®ç‡ = 1 - é€€è´§ç‡</li>
                            <li>ä»…ä¸å¯é€€å›æˆæœ¬åˆ†æ‘Šï¼šåˆ†æ‘Šåä¸å¯é€€å›æˆæœ¬ = åŸå§‹ä¸å¯é€€å›æˆæœ¬ Ã· æœ‰æ•ˆé”€å”®ç‡</li>
                            <li>å¯é€€å›è´¹ç”¨ï¼ˆå¹³å°ä½£é‡‘ã€é”€é¡¹ç¨ï¼‰é€€è´§åå¯å…¨é¢é€€å›ï¼Œä¸å‚ä¸åˆ†æ‘Š</li>
                            <li>ä¾‹å¦‚ï¼šä¸å¯é€€å›æˆæœ¬5å…ƒï¼Œé€€è´§ç‡20%ï¼Œåˆ™åˆ†æ‘Šåä¸å¯é€€å›æˆæœ¬ = 5 Ã· 80% = 6.25å…ƒ</li>
                        </ul>
                    </li>
                </ul>
            `;
        }

        /**
         * è®¡ç®—åˆç†å”®ä»·çš„ä¸»å‡½æ•°
         * 
         * é‡è¦è¯´æ˜ï¼šå”®ä»·è®¡ç®—æ¨¡å—ä¸åˆ©æ¶¦è®¡ç®—æ¨¡å—çš„å·®å¼‚
         * 1. å”®ä»·è®¡ç®—æ¨¡å—ï¼ˆæœ¬å‡½æ•°ï¼‰
         *    - ç›®çš„ï¼šç¡®ä¿æœ‰æ•ˆè®¢å•ï¼ˆæ‰£é™¤é€€è´§åï¼‰è¾¾åˆ°ç›®æ ‡åˆ©æ¶¦ç‡
         *    - åŸç†ï¼šåŸºäºé€€è´§ç‡æé«˜å”®ä»·ï¼Œç¡®ä¿å‰©ä½™æœ‰æ•ˆè®¢å•è¾¾åˆ°ç›®æ ‡åˆ©æ¶¦
         *    - ä¾‹å¦‚ï¼šç›®æ ‡åˆ©æ¶¦ç‡8%ï¼Œé€€è´§ç‡20%æ—¶ï¼š
         *      Â· å”®ä»·ä¼šè¢«é€‚å½“æé«˜ï¼Œä»¥ç¡®ä¿80%çš„æœ‰æ•ˆè®¢å•è¾¾åˆ°8%çš„åˆ©æ¶¦ç‡
         *      Â· æœ€ç»ˆå”®ä»·ä¼šé«˜äºç®€å•åŸºäº8%åˆ©æ¶¦ç‡è®¡ç®—çš„ä»·æ ¼
         * 
         * 2. ä¸åˆ©æ¶¦è®¡ç®—æ¨¡å—çš„åŒºåˆ«
         *    - å”®ä»·è®¡ç®—ï¼šå…³æ³¨å•ä¸ªæœ‰æ•ˆè®¢å•çš„åˆ©æ¶¦ç‡ï¼ˆé€€è´§åˆ†æ‘Šåï¼‰
         *    - åˆ©æ¶¦è®¡ç®—ï¼šå±•ç¤ºæ•´ä½“ä¸šåŠ¡çš„åˆ©æ¶¦ç‡ï¼ˆæ‰€æœ‰è®¢å•ï¼‰
         *    - è¿™å¯¼è‡´ï¼šç›¸åŒå”®ä»·ä¸‹ï¼Œåˆ©æ¶¦è®¡ç®—æ¨¡å—æ˜¾ç¤ºçš„åˆ©æ¶¦ç‡ä¼šé«˜äºç›®æ ‡åˆ©æ¶¦ç‡
         *    - åŸå› ï¼šå”®ä»·ä¸­åŒ…å«äº†å¯¹é€€è´§æŸå¤±çš„è¡¥å¿
         * 
         * 3. å®é™…åº”ç”¨å»ºè®®
         *    - å¦‚æœæƒ³è®©æ•´ä½“åˆ©æ¶¦ç‡æ¥è¿‘ç›®æ ‡å€¼ï¼Œå¯ä»¥é€‚å½“è°ƒä½è¿™é‡Œçš„ç›®æ ‡åˆ©æ¶¦ç‡
         *    - å»ºè®®é€šè¿‡å®é™…è¿è¥æ•°æ®æ¥è°ƒæ•´ç›®æ ‡åˆ©æ¶¦ç‡
         *    - å¯†åˆ‡å…³æ³¨é€€è´§ç‡å˜åŒ–å¯¹å®šä»·çš„å½±å“
         */
        function calculate() {
            // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
            document.getElementById("result").innerHTML = "";
            try {
                // 1. è·å–å¹¶éªŒè¯æ‰€æœ‰è¾“å…¥å€¼
                const inputs = getValidatedInputs();
                
                // 2. éªŒè¯æ¯”ä¾‹è´¹ç”¨ç»„åˆï¼ˆæŒ‰æœ€ç»ˆå”®ä»·å£å¾„ï¼‰ï¼š
                // éœ€æ»¡è¶³ 1 - (å¹³å° + é”€é¡¹ç¨å æ¯” + ç›®æ ‡åˆ©æ¶¦ + å¹¿å‘Šåˆ†æ‘Š - å¹¿å‘Šè¿›é¡¹æŠµæ‰£) > 0
                const returnRate = parseFloat(document.getElementById("returnRate").value) / 100 || 0;
                const effectiveRate = 1 - returnRate;
                const VAT_RATE = 0.06; // ç°ä»£æœåŠ¡ä¸šå¢å€¼ç¨ç‡6%
                const taxFactorOnFinal = inputs.salesTaxRate / (1 + inputs.salesTaxRate);
                const adFactorEffective = inputs.adRate / effectiveRate;
                const adVatCreditFactor = VAT_RATE * adFactorEffective;
                const profitFactorEffective = inputs.targetProfitRate; // åˆ©æ¶¦ç‡æŒ‰æœ€ç»ˆå”®ä»·å£å¾„
                const denominatorFinal = 1 - (inputs.platformRate + taxFactorOnFinal + profitFactorEffective + adFactorEffective - adVatCreditFactor);
                if (denominatorFinal <= 0) {
                    throw new Error("å‚æ•°ç»„åˆè¿‡é«˜ï¼ˆå¹³å°ã€ç¨è´¹å æ¯”ã€ç›®æ ‡åˆ©æ¶¦ã€å¹¿å‘Šè´¹(åˆ†æ‘Š) - å¹¿å‘Šè¿›é¡¹æŠµæ‰£ï¼‰ï¼Œæ— æ³•è®¡ç®—æœ‰æ•ˆå”®ä»·");
                }

                // 3. è®¡ç®—è¿›è´§æˆæœ¬å’Œå¯æŠµæ‰£è¿›é¡¹ç¨
                const purchaseCost = calculatePurchaseCost(inputs);
                
                // 4. è®¡ç®—é”€å”®æˆæœ¬å’Œæ€»å¯æŠµæ‰£ç¨é¢ï¼ˆä¸å«å¹¿å‘Šè´¹ï¼Œå› ä¸ºå¹¿å‘Šè´¹ä¼šåŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—ï¼‰
                const salesCost = calculateSalesCost(inputs, 0, purchaseCost);
                
                // 5. ä¸€æ¬¡æ€§è®¡ç®—æœ€ç»ˆä»·æ ¼å’Œå„é¡¹è´¹ç”¨
                const priceInfo = calculatePrices(purchaseCost, salesCost, inputs);

                // 6. æ›´æ–°é”€å”®æˆæœ¬é¢„è§ˆ
                updateSalesCostSummary(priceInfo.finalPrice);

                // 7. æ˜¾ç¤ºç»“æœ
                document.getElementById("result").innerHTML = generateResultHtml(purchaseCost, salesCost, priceInfo, inputs);
            } catch (error) {
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById("result").innerHTML = `
                    <div class="error">${error.message}</div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½ä¿å­˜çš„å€¼å¹¶è®¡ç®—
        window.onload = function() {
            loadSavedInputs();
            calculate();
        };
        
        // å®æ—¶è®¡ç®—è¿›è´§æˆæœ¬
        function updatePurchaseCostSummary() {
            try {
                const costPrice = parseFloat(document.getElementById("costPrice").value) || 0;
                const inputTaxRate = parseFloat(document.getElementById("inputTaxRate").value) / 100 || 0;
                const outputTaxRate = parseFloat(document.getElementById("outputTaxRate").value) / 100 || 0;

                const invoiceCost = costPrice * inputTaxRate;
                const totalPayment = costPrice + invoiceCost;
                const purchaseVAT = costPrice * outputTaxRate;
                const effectiveCost = totalPayment - purchaseVAT;

                document.getElementById("totalPayment").textContent = `Â¥${totalPayment.toFixed(2)}`;
                document.getElementById("effectiveCost").textContent = `Â¥${effectiveCost.toFixed(2)}`;
            } catch (error) {
                document.getElementById("totalPayment").textContent = "Â¥0.00";
                document.getElementById("effectiveCost").textContent = "Â¥0.00";
            }
        }

        // å®æ—¶è®¡ç®—é”€å”®æˆæœ¬
        function updateSalesCostSummary(finalPrice = 0) {
            try {
                // è·å–åŸºç¡€è¾“å…¥å€¼
                const shippingCost = parseFloat(document.getElementById("shippingCost").value) || 0;
                const shippingInsurance = parseFloat(document.getElementById("shippingInsurance").value) || 0;
                const otherCost = parseFloat(document.getElementById("otherCost").value) || 0;
                const returnRate = parseFloat(document.getElementById("returnRate").value) / 100 || 0;
                const salesTaxRate = parseFloat(document.getElementById("salesTaxRate").value) / 100 || 0;
                const platformRate = parseFloat(document.getElementById("platformRate").value) / 100 || 0;
                const adRate = parseFloat(document.getElementById("adRate").value) / 100 || 0;

                // è®¡ç®—æœ‰æ•ˆé”€å”®ç‡ï¼ˆè€ƒè™‘é€€è´§ï¼‰
                const effectiveRate = 1 - returnRate;

                // è®¡ç®—å›ºå®šæˆæœ¬ï¼ˆè€ƒè™‘é€€è´§åˆ†æ‘Šï¼‰
                const totalFixedCost = (shippingCost + shippingInsurance + otherCost) / effectiveRate;

                // è®¡ç®—åŸºäºæœ€ç»ˆå”®ä»·çš„è´¹ç”¨
                const platformFee = finalPrice * platformRate;
                const adCost = finalPrice * adRate;
                // å¹¿å‘Šè´¹ä¸ºä¸å¯é€€å›ï¼Œéœ€æŒ‰æœ‰æ•ˆé”€å”®ç‡åˆ†æ‘Š
                const adCostEffective = adCost / effectiveRate;
                const salesTax = finalPrice / (1 + salesTaxRate) * salesTaxRate;  // æ­£ç¡®çš„é”€é¡¹ç¨è®¡ç®—ï¼šå«ç¨ä»·Ã·(1+ç¨ç‡)Ã—ç¨ç‡

                // è®¡ç®—æ€»é”€å”®æˆæœ¬
                const totalSalesCost = totalFixedCost + platformFee + adCostEffective + salesTax;

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById("totalFixedCost").textContent = `Â¥${totalFixedCost.toFixed(2)}`;
                document.getElementById("platformFeePreview").textContent = `Â¥${platformFee.toFixed(2)}`;
                document.getElementById("adCostPreview").textContent = `Â¥${adCostEffective.toFixed(2)}`;
                document.getElementById("salesTax").textContent = `Â¥${salesTax.toFixed(2)}`;
                document.getElementById("totalSalesCost").textContent = `Â¥${totalSalesCost.toFixed(2)}`;

                // æ›´æ–°é”€é¡¹ç¨ç‡æ˜¾ç¤º
                const salesTaxLabel = document.querySelector('#salesCostSummary div:nth-child(4) span:first-child');
                salesTaxLabel.textContent = `é”€é¡¹ç¨ï¼ˆ${(salesTaxRate * 100).toFixed(1)}%ï¼‰ï¼š`;

            } catch (error) {
                document.getElementById("totalFixedCost").textContent = "Â¥0.00";
                document.getElementById("platformFeePreview").textContent = "Â¥0.00";
                document.getElementById("adCostPreview").textContent = "Â¥0.00";
                document.getElementById("salesTax").textContent = "Â¥0.00";
                document.getElementById("totalSalesCost").textContent = "Â¥0.00";
            }
        }

        // ä¸ºæ‰€æœ‰è¾“å…¥æ¡†æ·»åŠ å®æ—¶è®¡ç®—åŠŸèƒ½
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', () => {
                try {
                    // åˆ¤æ–­å½“å‰æ¿€æ´»çš„tab
                    const profitTabActive = document.getElementById('profitTab').classList.contains('active');
                    
                    if (profitTabActive) {
                        // åˆ©æ¶¦è®¡ç®—tabçš„å®æ—¶è®¡ç®—
                        try {
                            // è·å–åŸºç¡€è¾“å…¥
                            const costPrice = validateInput(parseFloat(document.getElementById('profitCostPrice').value), 0.01, 1000000, "è¿›è´§ä»·");
                            const actualPrice = validateInput(parseFloat(document.getElementById('actualPrice').value), 0.01, 1000000, "å®é™…å”®ä»·");
                            const inputTaxRate = validateInput(parseFloat(document.getElementById('profitInputTaxRate').value), 0, 100, "å¼€ç¥¨æˆæœ¬") / 100;
                            const outputTaxRate = validateInput(parseFloat(document.getElementById('profitOutputTaxRate').value), 0, 100, "å•†å“ç¨ç‡") / 100;
                            const platformRate = validateInput(parseFloat(document.getElementById('profitPlatformRate').value), 0, 100, "å¹³å°æŠ½ä½£æ¯”ä¾‹") / 100;
                            const shippingCost = validateInput(parseFloat(document.getElementById('profitShippingCost').value), 0, 10000, "ç‰©æµè´¹");
                            const shippingInsurance = validateInput(parseFloat(document.getElementById('profitShippingInsurance').value), 0, 100, "è¿è´¹é™©");
                            const adRate = validateInput(parseFloat(document.getElementById('profitAdRate').value), 0, 100, "å¹¿å‘Šè´¹ç”¨æ¯”ä¾‹") / 100;
                            const otherCost = validateInput(parseFloat(document.getElementById('profitOtherCost').value), 0, 10000, "å…¶ä»–æˆæœ¬");
                            const returnRate = validateInput(parseFloat(document.getElementById('profitReturnRate').value), 0, 100, "é€€è´§ç‡") / 100;

                            // è§¦å‘åˆ©æ¶¦è®¡ç®—
                            calculateProfit();
                        } catch (error) {
                            // å¦‚æœè¾“å…¥æ— æ•ˆï¼Œæ¸…ç©ºç»“æœåŒºåŸŸ
                            document.getElementById('result').innerHTML = '';
                        }
                    } else {
                        // å”®ä»·è®¡ç®—tabçš„å®æ—¶è®¡ç®—
                        try {
                            // è·å–å¹¶éªŒè¯æ‰€æœ‰è¾“å…¥å€¼
                            const inputs = getValidatedInputs();
                            
                            // è®¡ç®—è¿›è´§æˆæœ¬
                            const purchaseCost = calculatePurchaseCost(inputs);
                            
                            // è®¡ç®—é”€å”®æˆæœ¬ï¼ˆä¸å«å¹¿å‘Šè´¹ï¼Œå› ä¸ºå¹¿å‘Šè´¹ä¼šåŸºäºæœ€ç»ˆå”®ä»·è®¡ç®—ï¼‰
                            const salesCost = calculateSalesCost(inputs, 0, purchaseCost);
                            
                            // è®¡ç®—æœ€ç»ˆä»·æ ¼
                            const priceInfo = calculatePrices(purchaseCost, salesCost, inputs);

                            // æ›´æ–°æ˜¾ç¤º
                            updatePurchaseCostSummary();
                            updateSalesCostSummary(priceInfo.finalPrice);
                            calculate();
                        } catch (error) {
                            updatePurchaseCostSummary();
                            updateSalesCostSummary(0);
                        }
                    }
                } catch (error) {
                    // å¤„ç†ä»»ä½•æœªé¢„æœŸçš„é”™è¯¯
                    console.error('å®æ—¶è®¡ç®—é”™è¯¯:', error);
                }
            });
        });

        // é¡µé¢åŠ è½½æ—¶è®¡ç®—ä¸€æ¬¡
        window.addEventListener('load', () => {
            loadSavedInputs(); // å…ˆåŠ è½½ä¿å­˜çš„è¾“å…¥å€¼
            
            try {
                // é»˜è®¤æ˜¾ç¤ºåˆ©æ¶¦è®¡ç®—ç»“æœ
                calculateProfit();
            } catch (error) {
                console.error('åˆå§‹åŒ–è®¡ç®—é”™è¯¯:', error);
            }
        });
    </script>
</body>
</html>