<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <!-- 移动端视口适配：确保在手机端按设备宽度渲染，并启用沉浸式安全区域支持 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>电商合理售价计算器（税务合规版）</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- 新增：顶部导航栏 -->
        <div class="top-navigation">
            <div class="nav-container">
                <div class="nav-title">电商计算器</div>
                <div class="nav-links">
                    <a href="index.html" class="nav-link active">完整版</a>
                    <a href="simple-profit-calculator.html" class="nav-link">简化版</a>
                </div>
            </div>
        </div>

        <h2>电商合理售价计算器（税务合规版）</h2>
        
        <div class="tab-container">
            <div class="tabs">
                <button class="tab" onclick="switchTab('price')">售价计算</button>
                <button class="tab active" onclick="switchTab('profit')">利润计算</button>
                <button class="tab" onclick="switchTab('listprice')">标价计算</button>
                <button class="tab" onclick="switchTab('catalog')">商品清单</button>
            </div>
        </div>

        <!-- 售价计算tab -->
        <div id="priceTab" class="tab-content">
            <div class="section">
                <h3>第一步：基础成本</h3>
                <div class="step-description">
                    这部分是您需要支付给供应商的费用，包括商品本身的成本和相关税费。
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>进货价（不含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="costPrice" value="38" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">这是供应商提供的不含税商品价格</div>
                    </div>

                    <div class="input-group">
                        <label>开票成本（%）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="inputTaxRate" value="6" step="0.1">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">供应商开具发票时收取的额外费用比例（通常是6%）</div>
                    </div>

                    <div class="input-group">
                        <label>进项税率（%）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="outputTaxRate" value="13" step="0.1">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">商品的进项税率（如服装类13%），这部分税费将来可用于抵扣销项税</div>
                    </div>
                </div>

                
            </div>

            <div class="section">
                <h3>第二步：销售环节费用</h3>
                <div class="step-description">
                    这部分是在销售过程中产生的各项费用，包括平台费用、物流费用和营销费用。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">平台费用
                            <div class="switch-wrapper" title="免佣开关：开启后平台佣金按0%计算">
                                <span class="switch-label">免佣</span>
                                <label class="switch">
                                    <input type="checkbox" id="platformFreeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>平台抽佣比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="platformRate" value="5.5" step="0.1" class="compact-number">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">电商平台收取的交易佣金，基于最终售价（含税）计算</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">物流费用</div>
                        <div class="input-group">
                            <label>物流费（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的快递费用</div>
                        </div>

                        <div class="input-group">
                            <label>运费险（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的运费险费用</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">营销费用</div>
                        <div class="input-group">
                            <label>全店付费占比（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="adRate" value="30" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">广告费占最终售价的比例（全店口径），广告服务商可开具6%专票用于进项抵扣</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">其他费用</div>
                        <div class="input-group">
                            <label>其他成本（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="otherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">包装材料等其他固定成本（提示：该项为“预估”口径，建议纳入包装材料、耗材、办公与管理等未单独计提的固定/间接费用；不含随增值税附征的城建税、教育费附加、地方教育附加等税费）</div>
                        </div>
                    </div>

                     <!-- 新增：税费设置（将原先位于“其他费用”内的销项税率独立成单独模块） -->
                     <div class="cost-category">
                         <div class="category-title">税费设置</div>
                         <div class="input-group">
                             <label>销项税率（%）:</label>
                             <div class="input-wrapper">
                                 <!-- 保持原有ID不变：salesTaxRate，确保计算脚本中的读取逻辑无需改动 -->
                                 <input type="number" id="salesTaxRate" value="13" step="0.1">
                                 <button class="save-button" onclick="saveInputs()">保存</button>
                             </div>
                             <div class="field-hint">销项税率（如13%）。注意：销项税不是直接用含税价×13%，而是要先去税，即：含税价÷1.13×13%</div>
                         </div>
                     </div>
                </div>
            </div>

            <div class="section">
                <h3>第三步：目标设定</h3>
                <div class="step-description">
                    设置您的经营目标和风险预期，这将影响最终售价的计算。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">经营目标</div>
                        <div class="input-group">
                            <label>目标利润率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="targetProfitRate" value="5" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">您期望的利润率，基于最终售价计算（例：5%意味着每100元售价中有5元是利润）</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">风险预期</div>
                        <div class="input-group">
                            <label>预计退货率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="returnRate" value="20" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">预计的退货率，影响成本分摊（例：20%意味着每100单中有20单会退货）</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="calculate()">计算售价</button>
        </div><!-- 结束售价计算tab -->

        <!-- 利润计算tab -->
        <div id="profitTab" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h3>利润计算</h3>
                    <!-- 顶部右侧区域：免佣开关 + 批量推演按钮（置于模块标题行） -->
                    <div class="header-actions" title="免佣开关：与下方平台费用免佣联动">
                        <div class="switch-wrapper switch-chip">
                            <span class="switch-label">免佣</span>
                            <label class="switch">
                                <input type="checkbox" id="profitPlatformFreeToggleTop">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <!-- 批量利润率推演按钮（仅更改广告占比与退货率做推演） -->
                        <button id="btnBatchScenario" class="header-btn">利润率推演</button>
                        <!-- 新增：价格推演按钮（固定其他参数，变动含税售价×退货率×付费占比） -->
                        <button id="btnPriceExploration" class="header-btn">价格推演</button>
                    </div>
                </div>
                <div class="step-description">
                    输入商品的进货价和实际售价，计算各项成本和最终利润。
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>进货价（不含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="profitCostPrice" value="38" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">这是供应商提供的不含税商品价格</div>
                    </div>

                    <div class="input-group">
                        <label>实际售价（含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="actualPrice" value="79" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">实际销售时的含税价格（买家到手价）</div>
                    </div>

                    <div class="input-group">
                        <label>含税利润率:</label>
                        <div class="input-wrapper" style="position: relative;">
                            <input type="text" id="actualProfit" readonly style="background-color: #f8f9fa; cursor: default;">
                            <div id="profitRate" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #2ea44f; font-size: 0.9rem;"></div>
                        </div>
                        <div class="field-hint" style="display: flex; justify-content: space-between;">
                            <span>计算得出的实际利润金额</span>
                            <span id="profitStatus" style="font-weight: 500;"></span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>税费占比:</label>
                        <div class="input-wrapper" style="position: relative;">
                            <input type="text" id="taxRatio" readonly style="background-color: #f8f9fa; cursor: help;" title="鼠标悬停查看详细税费计算过程">
                            <div id="taxRatioPercent" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #e65100; font-size: 0.9rem;"></div>
                        </div>
                        <div class="field-hint">税费占销售额的比重，鼠标悬停查看详细计算过程</div>
                    </div>
                </div>
                <!-- 价格指标：基于含税口径，展示常用倍率/加成/毛利率指标 -->
                <div class="section" style="margin-top: 1rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <h3 style="margin:0;">价格指标</h3>
                        <div style="display:flex; align-items:center; gap:8px; font-size:0.85rem;">
                            <span style="color:#666;">口径切换：</span>
                            <label class="switch" style="transform:scale(0.8);">
                                <input type="checkbox" id="taxViewToggle" onchange="toggleTaxView()">
                                <span class="slider"></span>
                            </label>
                            <span id="taxViewLabel" style="color:#2ea44f; font-weight:500;">含税视图</span>
                        </div>
                    </div>
                    <div id="taxViewDescription" style="color:#666; font-size:0.85rem; margin-bottom:8px; font-style:italic;">
                        当前口径：含税售价 vs 进货实际成本（不含进项税）
                    </div>
                    <div class="metrics-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center; cursor: help;" 
                             data-tooltip="加价倍率计算过程" 
                             onmouseenter="showPriceMetricTooltip(event, 'multiple')">
                            <div style="color:#666; font-size:0.9rem;">加价倍率</div>
                            <div id="metricMultiple" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div data-formula="multiple" style="color:#999; font-size:0.8rem; margin-top:2px;">售价÷进货实际成本</div>
                        </div>
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center; cursor: help;" 
                             data-tooltip="毛利率计算过程" 
                             onmouseenter="showPriceMetricTooltip(event, 'gross')">
                            <div style="color:#666; font-size:0.9rem;">毛利率</div>
                            <div id="metricGrossMargin" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div data-formula="gross" style="color:#999; font-size:0.8rem; margin-top:2px;">(售价-进货实际成本)÷售价</div>
                        </div>
                        <div id="metricBreakevenROICard" style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center; cursor: help;">
                            <div style="color:#666; font-size:0.9rem;">保本 ROI</div>
                            <div id="metricBreakevenROI" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div style="color:#999; font-size:0.8rem; margin-top:2px;">GMV÷广告费</div>
                        </div>
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center;">
                            <div style="color:#666; font-size:0.9rem;">保本广告占比</div>
                            <div id="metricBreakevenAdRate" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div style="color:#999; font-size:0.8rem; margin-top:2px;">单品付费占比警戒线</div>
                        </div>
                    </div>
                    <div style="color:#999; font-size:0.8rem; margin-top:6px;">提示：加价倍率和毛利率只反映“售价与进货价”的相对关系，保本ROI和保本广告占比则反映了退货率、税费、运费、广告等费用对利润的影响。</div>

                    <!-- 保本建议售价（利润率=0）展示 -->
                    <div style="margin-top: 12px; background:#fff; border:1px solid #eee; border-radius:8px; padding:12px; display:flex; align-items:center; justify-content:space-between;">
                        <div>
                            <div style="font-weight:600;">保本建议售价（利润率=0） </div>
                            <div style="color:#999; font-size:0.85rem; margin-top:2px;">按当前参数在利润率为0时联立求解的含税售价</div>
                        </div>
                        <div class="breakeven-right">
                            <div id="breakevenPriceValue" style="font-size:1.25rem; font-weight:700; color:#2ea44f;">-</div>
                            <div id="breakevenPriceNote" class="breakeven-note">&nbsp;</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>费用设置</h3>
                <div class="step-description">
                    设置各项费用参数，这些参数将影响最终的利润计算。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">营销费用</div>
                        <div class="input-group">
                            <label>全店付费占比（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitAdRate" value="30" step="1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">广告费占最终售价的比例，广告服务商可开具6%专票，用于进项税抵扣。</div>
                        </div>
                         <!-- 快速调整拉杆：营销费用占比 -->
                         <div class="quick-slider">
                             <input type="range" id="profitAdRateSlider" min="0" max="100" step="1">
                             <div class="quick-slider-meta">
                                 <span class="quick-slider-label">快速调整</span>
                                 <span id="profitAdRateSliderValue" class="quick-slider-value">30%</span>
                             </div>
                         </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            💡 提示：广告费用可以获得6%的进项税抵扣。由于广告费金额较大，这部分抵扣会显著降低实际营销成本。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">风险预期</div>
                        <div class="input-group">
                            <label>预计退货率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitReturnRate" value="20" step="1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">预计的退货率，影响成本分摊（例：20%意味着每100单中有20单会退货）</div>
                        </div>
                         <!-- 快速调整拉杆：预计退货率 -->
                         <div class="quick-slider">
                             <input type="range" id="profitReturnRateSlider" min="0" max="100" step="1">
                             <div class="quick-slider-meta">
                                 <span class="quick-slider-label">快速调整</span>
                                 <span id="profitReturnRateSliderValue" class="quick-slider-value">20%</span>
                             </div>
                         </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #fff7e6; border-radius: 4px; font-size: 0.85rem; color: #e65100;">
                            注意：此处是“退货退款率”。请剔除仅退款（不退货）订单，只统计退货退款的比例；
                            若将仅退款计入，会显著高估退货成本，导致保本/建议售价偏高。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">税费设置</div>
                        <div class="input-group">
                            <label>开票成本（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitInputTaxRate" value="6" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">供应商开具发票时收取的额外费用比例（通常是6%）</div>
                        </div>

                        <div class="input-group">
                            <label>商品进项税率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOutputTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">商品的进项税率，用于计算可抵扣的进项税额（如服装类13%）</div>
                        </div>

                        <div class="input-group">
                            <label>销项税率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitSalesTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">销售时的增值税税率，通常与商品进项税率相同（如服装类13%）</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">平台费用
                            <div class="switch-wrapper" title="免佣开关：开启后平台佣金按0%计算">
                                <span class="switch-label">免佣</span>
                                <label class="switch">
                                    <input type="checkbox" id="profitPlatformFreeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>平台抽佣比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitPlatformRate" value="5.5" step="0.1" class="compact-number">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">电商平台收取的交易佣金，基于最终售价（含税）计算。平台开具6%专票，可抵扣进项税。</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            💡 提示：平台佣金可以获得6%的进项税抵扣，这部分抵扣会降低实际成本。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">物流费用</div>
                        <div class="input-group">
                            <label>物流费（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的快递费用</div>
                        </div>

                        <div class="input-group">
                            <label>运费险（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的运费险费用</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">其他费用</div>
                        <div class="input-group">
                            <label>其他成本（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOtherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">包装材料等其他固定成本（提示：该项为“预估”口径，建议纳入包装材料、耗材、办公与管理等未单独计提的固定/间接费用；不含随增值税附征的城建税、教育费附加、地方教育附加等税费）</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="calculateProfit()">计算利润</button>
        </div>

        <!-- 标价计算tab -->
        <div id="listpriceTab" class="tab-content">
            <div class="section" style="margin-bottom: 12px;">
                <h3 style="display:flex; align-items:center; gap:8px; margin-bottom:1.5rem;">
                    标价计算
                    <span style="font-size:12px; font-weight:500; color:#666; background:#f3f4f6; border:1px solid #e5e7eb; padding:2px 6px; border-radius:999px;">到手价为核心，活动为变量</span>
                </h3>
                <div class="step-description" style="margin-bottom:12px; color:#666;">
                    先确定<strong>目标到手价</strong>（叠加优惠后的买家实付），再选择店铺活动；系统将<span style="font-weight:600;">实时倒推</span>活动前的建议标价。
                </div>

                <!-- C位：目标到手价 + 活动选择（紧凑主卡片） -->
                <div class="primary-card" style="background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow: 0 1px 2px rgba(0,0,0,0.04);">
                    <!-- 顶部：目标到手价设置 -->
                    <div style="display:grid; grid-template-columns: 1.2fr 1.8fr; gap:16px; align-items:start;">
                        <div>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                <label style="font-weight:600;">目标到手价（含税，元）</label>
                                <div style="display:flex; gap:8px; align-items:center;">
                                    <button type="button" class="batch-modal-btn" style="margin:0; padding:4px 8px; font-size:12px;" onclick="addTargetPrice()">新增</button>
                                    <button type="button" class="batch-modal-btn" style="margin:0; padding:4px 8px; font-size:12px;" onclick="clearAllTargetPrices()">清空</button>
                                </div>
                            </div>
                            
                            <!-- 到手价目标列表 -->
                            <div id="targetPriceList" style="display:flex; flex-direction:column; gap:8px;">
                                <div class="target-price-row">
                                    <div class="input-wrapper" style="display:flex; gap:8px;">
                                        <input type="number" class="target-price-input" value="59" step="0.01" 
                                               style="font-size:1.4rem; font-weight:700; padding:12px 14px; width:100%; border-radius:10px;">
                                        <button class="save-button" onclick="saveInputs()">保存</button>
                                        <button type="button" class="batch-modal-btn" onclick="removeTargetPrice(this)" style="margin:0; padding:8px 12px;">删除</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="field-hint" style="margin-top:6px;">买家最终支付价（叠加所有优惠后）。可设置多个目标价进行批量计算。</div>
                        </div>

                        <!-- 活动勾选：单品立减 + 满减概览 -->
                        <div>
                            <div style="display:grid; grid-template-columns: 1fr; gap:12px;">
                                <div>
                                    <div style="font-weight:600; margin-bottom:6px;">单品立减档位</div>
                                    <div id="rateOptions" class="input-wrapper" style="display:flex; flex-wrap:wrap; gap:12px;">
                                        <!-- 默认勾选：10%、12%、15%；其他不勾选。这里仅改变“默认状态”，用户更改后会由 saveInputs() 持久化到 localStorage -->
                                        <label style="display:flex; align-items:center; gap:6px;">
                                            <input type="checkbox" class="lp-rate" value="0"> 无立减
                                        </label>
                                        <label style="display:flex; align-items:center; gap:6px;">
                                            <input type="checkbox" class="lp-rate" value="0.10" checked> 立减10%
                                        </label>
                                        <label style="display:flex; align-items:center; gap:6px;">
                                            <input type="checkbox" class="lp-rate" value="0.12" checked> 立减12%
                                        </label>
                                        <label style="display:flex; align-items:center; gap:6px;">
                                            <input type="checkbox" class="lp-rate" value="0.15" checked> 立减15%
                                        </label>
                                        <label style="display:flex; align-items:center; gap:6px;">
                                            <input type="checkbox" class="lp-rate" value="0.18"> 立减18%
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <div style="display:flex; justify-content:space-between; align-items:center;">
                                        <div style="font-weight:600;">满减规则</div>
                                        <div style="font-size:12px; color:#666;">（可设置多档）</div>
                                    </div>
                                    <div id="fullReductionList" style="display:flex; flex-direction: column; gap: 8px; margin-top:6px;">
                                        <!-- 行模板：由脚本生成；但提供一行默认值便于开箱即用 -->
                                        <div class="tier-row" style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                                            <span style="color:#666; font-size:0.9rem;">满</span>
                                            <input type="number" class="tier-threshold" value="99" step="0.01" style="width:120px;max-width:100%;">
                                            <span style="color:#666; font-size:0.9rem;">减</span>
                                            <input type="number" class="tier-off" value="10" step="0.01" style="width:120px;max-width:100%;">
                                            <button type="button" class="save-button" onclick="saveInputs()" style="margin:0;">保存</button>
                                            <button type="button" class="batch-modal-btn" onclick="removeTierRow(this)" style="margin:0;">删除</button>
                                        </div>
                                    </div>
                                    <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
                                        <button type="button" class="batch-modal-btn primary" style="margin:0;" onclick="addTierRow()">新增一档</button>
                                        <button type="button" class="batch-modal-btn" style="margin:0;" onclick="saveInputs()">保存规则</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>

            <!-- 操作区：强引导只保留一个主按钮 -->
            <div style="display:flex; justify-content:flex-end; gap:8px;">
                <button onclick="calculateListPrice()">计算标价</button>
            </div>
        </div>

        <!-- 商品清单tab -->
        <div id="catalogTab" class="tab-content">
            <div class="section">
                <h3 style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                    商品清单
                    <span style="font-size:12px; color:#666; font-weight:500;">多商品多平台批量计算（利润/利润率/保本ROI/保本广告占比）</span>
                </h3>
                <!-- 工具栏 -->
                <div id="catalogToolbar" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:12px;">
                    <button id="btnCatalogAddRow" class="header-btn" style="margin:0;">新增一行</button>
                    <input id="catalogImportFile" type="file" accept=".csv,.xlsx,.xls" style="display:none;" />
                    <button id="btnCatalogImport" class="header-btn" style="margin:0;">导入文件</button>
                    <button id="btnCatalogExport" class="header-btn" style="margin:0;">导出 CSV 模板</button>
                    <button id="btnCatalogDeleteSelected" class="header-btn" style="margin:0; background:#ef4444; border-color:#ef4444;">批量删除所选</button>
                    <button id="btnCatalogRecomputeAll" class="header-btn" style="margin:0;">一键重算</button>
                    <button id="btnCatalogExamples" class="header-btn" style="margin:0; background:#10b981; border-color:#10b981;">插入示例</button>
                    <button id="btnPlatformSettings" class="header-btn" style="margin:0;">平台设置</button>
                    <button id="btnCatalogFullscreen" class="header-btn" style="margin:0;">全屏显示</button>
                    <button id="btnCatalogUndoImport" class="header-btn" style="margin:0; display:none;">撤销上次导入</button>
                </div>
                
                <!-- 搜索和筛选工具栏 -->
                <div id="catalogSearchToolbar" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:16px; padding:16px; background:#f8fafc; border:1px solid #e5e7eb; border-radius:8px;">
                    <!-- 搜索框 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:200px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">搜索商品</label>
                        <input id="catalogSearchInput" type="text" placeholder="搜索商品名称或货号（支持关键词任意顺序）..." style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;" />
                    </div>
                    
                    <!-- 平台筛选 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:120px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">平台筛选</label>
                        <select id="catalogPlatformFilter" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                            <option value="">全部平台</option>
                        </select>
                    </div>
                    
                    <!-- 退货率区间筛选 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:140px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">退货率区间</label>
                        <div style="display:flex; gap:4px; align-items:center;">
                            <input id="catalogReturnRateMin" type="number" placeholder="最小%" step="0.1" min="0" max="100" style="padding:8px 8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:60px; text-align:center;" />
                            <span style="color:#6b7280; font-size:12px;">~</span>
                            <input id="catalogReturnRateMax" type="number" placeholder="最大%" step="0.1" min="0" max="100" style="padding:8px 8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:60px; text-align:center;" />
                        </div>
                    </div>
                    
                    <!-- 保本广告占比筛选 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:160px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">保本广告占比筛选</label>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <label style="display:flex; align-items:center; gap:4px; font-size:12px; color:#dc2626; cursor:pointer;">
                                <input id="catalogDangerFilter" type="checkbox" style="margin:0;" />
                                <span>⚠️ 低于21%风险商品</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- 排序选项 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:140px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">排序方式</label>
                        <select id="catalogSortBy" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                            <option value="">默认排序</option>
                            <option value="name">按名称排序</option>
                            <option value="sku">按货号排序</option>
                            <option value="returnRate">按退货率排序</option>
                            <option value="salePrice">按售价排序</option>
                        </select>
                    </div>
                    
                    <!-- 排序方向 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:100px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">排序方向</label>
                        <select id="catalogSortOrder" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                            <option value="asc">升序</option>
                            <option value="desc">降序</option>
                        </select>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div style="display:flex; flex-direction:column; gap:4px; min-width:120px;">
                        <label style="font-size:12px; color:#374151; font-weight:500;">操作</label>
                        <div style="display:flex; gap:8px;">
                            <button id="btnCatalogApplyFilters" class="header-btn" style="margin:0; padding:8px 12px; font-size:14px;">应用筛选</button>
                            <button id="btnCatalogClearFilters" class="header-btn" style="margin:0; padding:8px 12px; font-size:14px; background:#6b7280; border-color:#6b7280;">清除筛选</button>
                        </div>
                    </div>
                </div>
                <!-- 表格容器 -->
                <div id="catalogTableContainer" class="lp-card" style="padding:0; overflow:auto;"></div>
                <!-- 全屏弹窗：初始隐藏，打开时将表格容器临时移动到此处 -->
                                        <div id="catalogFullscreenOverlay" style="display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
                    <div role="dialog" aria-modal="true" aria-label="商品清单全屏" style="background:#fff; width:96vw; height:92vh; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.2); display:flex; flex-direction:column; overflow:hidden;">
                        <!-- 全屏模式隐藏的文件输入框 -->
                        <input id="catalogFullscreenImportFile" type="file" accept=".csv,.xlsx,.xls" style="display:none;" />
                        <div style="display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #e5e7eb;">
                            <div style="font-weight:600; color:#111827;">商品清单（全屏）</div>
                            <div style="display:flex; gap:8px; align-items:center;">
                                <button id="btnCatalogFullscreenAddRow" class="header-btn" style="margin:0;">新增一行</button>
                                <button id="btnCatalogFullscreenImport" class="header-btn" style="margin:0;">导入文件</button>
                                <button id="btnCatalogFullscreenDeleteSelected" class="header-btn" style="margin:0; background:#ef4444; border-color:#ef4444;">批量删除所选</button>
                                <button id="btnCatalogFullscreenRecompute" class="header-btn" style="margin:0;">一键重算</button>
                                <button id="btnCatalogFullscreenClose" class="header-btn" style="margin:0;">退出全屏</button>
                            </div>
                        </div>
                        
                        <!-- 全屏模式搜索和筛选工具栏 -->
                        <div id="catalogFullscreenSearchToolbar" style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin:12px; padding:16px; background:#f8fafc; border:1px solid #e5e7eb; border-radius:8px;">
                            <!-- 搜索框 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:200px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">搜索商品</label>
                                <input id="catalogFullscreenSearchInput" type="text" placeholder="搜索商品名称或货号（支持关键词任意顺序）..." style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;" />
                            </div>
                            
                            <!-- 平台筛选 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:120px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">平台筛选</label>
                                <select id="catalogFullscreenPlatformFilter" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                                    <option value="">全部平台</option>
                                </select>
                            </div>
                            
                            <!-- 退货率区间筛选 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:140px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">退货率区间</label>
                                <div style="display:flex; gap:4px; align-items:center;">
                                    <input id="catalogFullscreenReturnRateMin" type="number" placeholder="最小%" step="0.1" min="0" max="100" style="padding:8px 8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:60px; text-align:center;" />
                                    <span style="color:#6b7280; font-size:12px;">~</span>
                                    <input id="catalogFullscreenReturnRateMax" type="number" placeholder="最大%" step="0.1" min="0" max="100" style="padding:8px 8px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:60px; text-align:center;" />
                                </div>
                            </div>
                            
                            <!-- 保本广告占比筛选 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:160px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">保本广告占比筛选</label>
                                <div style="display:flex; gap:8px; align-items:center;">
                                    <label style="display:flex; align-items:center; gap:4px; font-size:12px; color:#dc2626; cursor:pointer;">
                                        <input id="catalogFullscreenDangerFilter" type="checkbox" style="margin:0;" />
                                        <span>⚠️ 低于21%风险商品</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- 排序选项 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:140px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">排序方式</label>
                                <select id="catalogFullscreenSortBy" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                                    <option value="">默认排序</option>
                                    <option value="name">按名称排序</option>
                                    <option value="sku">按货号排序</option>
                                    <option value="returnRate">按退货率排序</option>
                                    <option value="salePrice">按售价排序</option>
                                </select>
                            </div>
                            
                            <!-- 排序方向 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:100px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">排序方向</label>
                                <select id="catalogFullscreenSortOrder" style="padding:8px 12px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; width:100%;">
                                    <option value="asc">升序</option>
                                    <option value="desc">降序</option>
                                </select>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div style="display:flex; flex-direction:column; gap:4px; min-width:120px;">
                                <label style="font-size:12px; color:#374151; font-weight:500;">操作</label>
                                <div style="display:flex; gap:8px;">
                                    <button id="btnCatalogFullscreenApplyFilters" class="header-btn" style="margin:0; padding:8px 12px; font-size:14px;">应用筛选</button>
                                    <button id="btnCatalogFullscreenClearFilters" class="header-btn" style="margin:0; padding:8px 12px; font-size:14px; background:#6b7280; border-color:#6b7280;">清除筛选</button>
                                </div>
                            </div>
                        </div>
                        <div id="catalogFullscreenBody" style="flex:1; overflow:auto; background:#f9fafb; padding:12px;"></div>
                    </div>
                </div>
                <!-- 状态区 -->
                <div id="catalogStatus" style="margin-top:10px; color:#666; font-size:0.9rem;">共 0 条，0 条异常</div>
            </div>
        </div>

        <div class="result" id="result"></div>

        <!-- 分享为图片工具栏：固定在结果区域下方，不随结果替换而消失 -->
        <div id="shareToolbar" class="share-toolbar" aria-label="分享与导出">
            <button id="btnDownloadImage" class="share-btn" disabled>保存为图片</button>
            <button id="btnCopyImage" class="share-btn" disabled>复制图片</button>
            <button id="btnShareImage" class="share-btn" disabled>系统分享</button>
        </div>
        
        <div class="description">
            <p>计算说明：</p>
            <ul>
                <li>进货价请填写不含税价格</li>
                <li>开票成本是供应商收取的开票费用比例（如6%）</li>
                <li>销项税率用于计算可抵扣的进项税额（如服装类目13%）</li>
                <li>计算结果已考虑开票成本、税费抵扣、平台抽佣等</li>
                <li>目标利润率基于最终售价计算</li>
                <li>其他成本为“预估口径”，用于汇总包装材料、耗材、办公与管理等未单独计提的固定/间接费用；不包含以下随增值税附征或按规定征收的税费（这些税费已体现在“增值税销项—进项抵扣”的口径内，或另行按政策缴纳）：
                    <ul>
                        <li>增值税（常见税率：13%，部分行业为9%或6%）</li>
                        <li>城建税（对实际缴纳的增值税等按7%/5%/1%征收，视地区而定）</li>
                        <li>教育费附加（3%）</li>
                        <li>地方教育附加（2%）</li>
                        <li>印花税（常见0.03%或按票据种类从定额/定率计征）</li>
                        <li>房产税（按房产原值1.2%或按租金12%计征，依口径不同）</li>
                        <li>土地使用税（按占地面积征收，各地标准不同）</li>
                    </ul>
                </li>
                <li>温馨提示：除“增值税销项—进项抵扣”已在模型中精确计算外，其余附加税费通常与增值税应纳额或资产/面积口径相关，难以按单笔订单精准分摊，本工具未单独逐项拆分，建议在“其他成本”中作保守预估。</li>
            </ul>
        </div>
    </div>

    <!-- html2canvas：用于将结果区域渲染为图片（CDN 引入） -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <!-- xlsx：用于导入Excel文件（CDN 引入） -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- 商品清单示例数据（独立文件） -->
    <script src="js/catalog-samples.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/result-template.js"></script>
    <script src="js/price-template.js"></script>
</body>
</html>