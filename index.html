<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>电商合理售价计算器（税务合规版）</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h2>电商合理售价计算器（税务合规版）</h2>
        
        <div class="tab-container">
            <div class="tabs">
                <button class="tab" onclick="switchTab('price')">售价计算</button>
                <button class="tab active" onclick="switchTab('profit')">利润计算</button>
            </div>
        </div>

        <!-- 售价计算tab -->
        <div id="priceTab" class="tab-content">
            <div class="section">
                <h3>第一步：基础成本</h3>
                <div class="step-description">
                    这部分是您需要支付给供应商的费用，包括商品本身的成本和相关税费。
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>进货价（不含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="costPrice" value="38" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">这是供应商提供的不含税商品价格</div>
                    </div>

                    <div class="input-group">
                        <label>开票成本（%）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="inputTaxRate" value="6" step="0.1">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">供应商开具发票时收取的额外费用比例（通常是6%）</div>
                    </div>

                    <div class="input-group">
                        <label>商品税率（%）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="outputTaxRate" value="13" step="0.1">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">商品的增值税税率（如服装类13%），这部分税费将来可以抵扣</div>
                    </div>
                </div>

                
            </div>

            <div class="section">
                <h3>第二步：销售环节费用</h3>
                <div class="step-description">
                    这部分是在销售过程中产生的各项费用，包括平台费用、物流费用和营销费用。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">平台费用
                            <div class="switch-wrapper" title="免佣开关：开启后平台佣金按0%计算">
                                <span class="switch-label">免佣</span>
                                <label class="switch">
                                    <input type="checkbox" id="platformFreeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>平台抽佣比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="platformRate" value="5.5" step="0.1" class="compact-number">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">电商平台收取的交易佣金，基于最终售价（含税）计算</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">物流费用</div>
                        <div class="input-group">
                            <label>物流费（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的快递费用</div>
                        </div>

                        <div class="input-group">
                            <label>运费险（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="shippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的运费险费用</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">营销费用</div>
                        <div class="input-group">
                            <label>广告费用比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="adRate" value="30" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">广告费占最终售价的比例，可开具6%专票抵扣税款</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">其他费用</div>
                        <div class="input-group">
                            <label>其他成本（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="otherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">包装材料等其他固定成本</div>
                        </div>

                        <div class="input-group">
                            <label>销项税率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="salesTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">销项税率（如13%）。注意：销项税不是直接用含税价×13%，而是要先去税，即：含税价÷1.13×13%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>第三步：目标设定</h3>
                <div class="step-description">
                    设置您的经营目标和风险预期，这将影响最终售价的计算。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">经营目标</div>
                        <div class="input-group">
                            <label>目标利润率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="targetProfitRate" value="5" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">您期望的利润率，基于最终售价计算（例：5%意味着每100元售价中有5元是利润）</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">风险预期</div>
                        <div class="input-group">
                            <label>预计退货率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="returnRate" value="20" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">预计的退货率，影响成本分摊（例：20%意味着每100单中有20单会退货）</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="calculate()">计算售价</button>
        </div><!-- 结束售价计算tab -->

        <!-- 利润计算tab -->
        <div id="profitTab" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h3>利润计算</h3>
                    <!-- 顶部右侧免佣开关（与平台费用中的免佣同步） -->
                    <div class="header-actions" title="免佣开关：与下方平台费用免佣联动">
                        <div class="switch-wrapper">
                            <span class="switch-label">免佣</span>
                            <label class="switch">
                                <input type="checkbox" id="profitPlatformFreeToggleTop">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="step-description">
                    输入商品的进货价和实际售价，计算各项成本和最终利润。
                </div>
                <div class="input-groups-container">
                    <div class="input-group">
                        <label>进货价（不含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="profitCostPrice" value="38" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">这是供应商提供的不含税商品价格</div>
                    </div>

                    <div class="input-group">
                        <label>实际售价（含税）:</label>
                        <div class="input-wrapper">
                            <input type="number" id="actualPrice" value="79" step="0.01">
                            <button class="save-button" onclick="saveInputs()">保存</button>
                        </div>
                        <div class="field-hint">实际销售时的含税价格（买家到手价）</div>
                    </div>

                    <div class="input-group">
                        <label>实际利润:</label>
                        <div class="input-wrapper" style="position: relative;">
                            <input type="text" id="actualProfit" readonly style="background-color: #f8f9fa; cursor: default;">
                            <div id="profitRate" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #2ea44f; font-size: 0.9rem;"></div>
                        </div>
                        <div class="field-hint" style="display: flex; justify-content: space-between;">
                            <span>计算得出的实际利润金额</span>
                            <span id="profitStatus" style="font-weight: 500;"></span>
                        </div>
                    </div>
                </div>
                <!-- 价格指标：基于输入的进货价与含税售价，展示常用倍率/加成/毛利率指标 -->
                <div class="section" style="margin-top: 1rem;">
                    <h3>价格指标（基于进货价与含税售价）</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center;">
                            <div style="color:#666; font-size:0.9rem;">加价倍率</div>
                            <div id="metricMultiple" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div style="color:#999; font-size:0.8rem; margin-top:2px;">售价 ÷ 进货价</div>
                        </div>
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center;">
                            <div style="color:#666; font-size:0.9rem;">加成率</div>
                            <div id="metricMarkupRate" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div style="color:#999; font-size:0.8rem; margin-top:2px;">(售价 - 进货价) ÷ 进货价</div>
                        </div>
                        <div style="background:#f8f9fa; border-radius:8px; padding:12px; text-align:center;">
                            <div style="color:#666; font-size:0.9rem;">毛利率</div>
                            <div id="metricGrossMargin" style="font-size:1.25rem; font-weight:600; margin-top:4px;">-</div>
                            <div style="color:#999; font-size:0.8rem; margin-top:2px;">(售价 - 进货价) ÷ 售价</div>
                        </div>
                    </div>
                    <div style="color:#999; font-size:0.8rem; margin-top:6px;">提示：以上指标只反映“售价与进货价”的相对关系，未计入税费、运费、广告等经营费用。</div>

                    <!-- 保本建议售价（利润率=0）展示 -->
                    <div style="margin-top: 12px; background:#fff; border:1px solid #eee; border-radius:8px; padding:12px; display:flex; align-items:center; justify-content:space-between;">
                        <div>
                            <div style="font-weight:600;">保本建议售价（利润率=0） </div>
                            <div style="color:#999; font-size:0.85rem; margin-top:2px;">按当前参数在利润率为0时联立求解的含税售价</div>
                        </div>
                        <div class="breakeven-right">
                            <div id="breakevenPriceValue" style="font-size:1.25rem; font-weight:700; color:#2ea44f;">-</div>
                            <div id="breakevenPriceNote" class="breakeven-note">&nbsp;</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>费用设置</h3>
                <div class="step-description">
                    设置各项费用参数，这些参数将影响最终的利润计算。
                </div>
                <div class="input-groups-container">
                    <div class="cost-category">
                        <div class="category-title">营销费用</div>
                        <div class="input-group">
                            <label>广告费用比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitAdRate" value="30" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">广告费占最终售价的比例，广告服务商开具6%专票，可抵扣进项税。</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            💡 提示：广告费用可以获得6%的进项税抵扣。由于广告费金额较大，这部分抵扣会显著降低实际营销成本。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">风险预期</div>
                        <div class="input-group">
                            <label>预计退货率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitReturnRate" value="20" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">预计的退货率，影响成本分摊（例：20%意味着每100单中有20单会退货）</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #fff7e6; border-radius: 4px; font-size: 0.85rem; color: #e65100;">
                            注意：此处是“退货退款率”。请剔除仅退款（不退货）订单，只统计退货退款的比例；
                            若将仅退款计入，会显著高估退货成本，导致保本/建议售价偏高。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">税费设置</div>
                        <div class="input-group">
                            <label>开票成本（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitInputTaxRate" value="6" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">供应商开具发票时收取的额外费用比例（通常是6%）</div>
                        </div>

                        <div class="input-group">
                            <label>商品进项税率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOutputTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">商品的进项税率，用于计算可抵扣的进项税额（如服装类13%）</div>
                        </div>

                        <div class="input-group">
                            <label>销项税率（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitSalesTaxRate" value="13" step="0.1">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">销售时的增值税税率，通常与商品进项税率相同（如服装类13%）</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">平台费用
                            <div class="switch-wrapper" title="免佣开关：开启后平台佣金按0%计算">
                                <span class="switch-label">免佣</span>
                                <label class="switch">
                                    <input type="checkbox" id="profitPlatformFreeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>平台抽佣比例（%）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitPlatformRate" value="5.5" step="0.1" class="compact-number">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">电商平台收取的交易佣金，基于最终售价（含税）计算。平台开具6%专票，可抵扣进项税。</div>
                        </div>
                        <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f7ff; border-radius: 4px; font-size: 0.85rem; color: #2ea44f;">
                            💡 提示：平台佣金可以获得6%的进项税抵扣，这部分抵扣会降低实际成本。
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">物流费用</div>
                        <div class="input-group">
                            <label>物流费（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingCost" value="2.8" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的快递费用</div>
                        </div>

                        <div class="input-group">
                            <label>运费险（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitShippingInsurance" value="1.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">每个订单的运费险费用</div>
                        </div>
                    </div>

                    <div class="cost-category">
                        <div class="category-title">其他费用</div>
                        <div class="input-group">
                            <label>其他成本（元/单）:</label>
                            <div class="input-wrapper">
                                <input type="number" id="profitOtherCost" value="2.5" step="0.01">
                                <button class="save-button" onclick="saveInputs()">保存</button>
                            </div>
                            <div class="field-hint">包装材料等其他固定成本</div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="calculateProfit()">计算利润</button>
        </div>

        <div class="result" id="result"></div>

        <!-- 分享为图片工具栏：固定在结果区域下方，不随结果替换而消失 -->
        <div id="shareToolbar" class="share-toolbar" aria-label="分享与导出">
            <button id="btnDownloadImage" class="share-btn" disabled>保存为图片</button>
            <button id="btnCopyImage" class="share-btn" disabled>复制图片</button>
            <button id="btnShareImage" class="share-btn" disabled>系统分享</button>
        </div>
        
        <div class="description">
            <p>计算说明：</p>
            <ul>
                <li>进货价请填写不含税价格</li>
                <li>开票成本是供应商收取的开票费用比例（如6%）</li>
                <li>销项税率用于计算可抵扣的进项税额（如服装类目13%）</li>
                <li>计算结果已考虑开票成本、税费抵扣、平台抽佣等</li>
                <li>目标利润率基于最终售价计算</li>
            </ul>
        </div>
    </div>

    <!-- html2canvas：用于将结果区域渲染为图片（CDN 引入） -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/result-template.js"></script>
    <script src="js/price-template.js"></script>
</body>
</html>